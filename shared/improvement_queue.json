{
  "feature": "meta_model_weekly",
  "attempt": 2,
  "items": [
    {
      "priority": 1,
      "type": "target_construction",
      "description": "Switch to non-overlapping training: use every 5th row for training targets to eliminate target autocorrelation",
      "reason": "Root cause: overlapping 5-day targets share 4/5 days with neighbors, causing XGBoost to learn the moving average (constant positive) instead of conditional variation. Non-overlapping targets (~426 training samples) provide independent observations.",
      "resume_from": "architect",
      "research_needed": false,
      "implementation_notes": [
        "Option A: Subsample every 5th row from training data only (test remains overlapping for evaluation)",
        "Option B: Use all rows for training but weight loss by inversely proportional to overlap count",
        "Option A preferred for simplicity; 426 samples is still viable for XGBoost with 24 features (17.8:1 ratio)"
      ]
    },
    {
      "priority": 2,
      "type": "objective_function",
      "description": "Add naive-aware DA scoring to Optuna objective: penalize models whose DA matches naive always-up",
      "reason": "Current objective rewards any positive prediction because train set is 54% positive. Model converges to always-up which maximizes naive-biased DA + Sharpe. Objective must measure skill above naive, not raw DA.",
      "resume_from": "architect",
      "research_needed": false,
      "implementation_notes": [
        "Compute naive_da = fraction of positive val returns",
        "da_component = max(0, (val_da - naive_da) * 100) / 15.0  (skill above naive, not raw DA)",
        "Add penalty: if model_da == naive_da within 0.1pp, apply -0.1 to objective",
        "Sharpe component should also measure excess over buy-and-hold, not raw"
      ]
    },
    {
      "priority": 3,
      "type": "hyperparameter_space",
      "description": "Widen regularization ranges to allow more model expressiveness for weekly targets",
      "reason": "max_depth=2, min_child_weight=21 with strong lambda/alpha produces near-constant output on noisy weekly targets. Need wider range to explore more expressive models.",
      "resume_from": "architect",
      "research_needed": false,
      "implementation_notes": [
        "max_depth: [2, 6] (was [2, 4])",
        "min_child_weight: [5, 25] (was [12, 25])",
        "reg_lambda: [0.1, 15.0] (was [1.0, 15.0])",
        "reg_alpha: [0.01, 10.0] (was [0.5, 10.0])",
        "IMPORTANT: only widen if non-overlapping targets are used (otherwise risk overfitting)"
      ]
    },
    {
      "priority": 4,
      "type": "feature_engineering",
      "description": "Center target by subtracting training mean to remove positive bias",
      "reason": "Mean weekly return ~0.5% positive creates systematic bias toward positive predictions. Centering removes this, forcing model to learn deviations from mean.",
      "resume_from": "architect",
      "research_needed": false,
      "implementation_notes": [
        "y_train_centered = y_train - y_train.mean()",
        "y_val_centered = y_val - y_train.mean()",
        "Add back mean at prediction time for MAE/Sharpe evaluation",
        "Direction accuracy unaffected by centering if model learns relative magnitudes"
      ]
    },
    {
      "priority": 5,
      "type": "evaluation_method",
      "description": "Use non-overlapping Sharpe (Approach B, sqrt(52)) as primary in Optuna objective",
      "reason": "Approach A (daily returns, sqrt(252)) inflates Sharpe for always-long due to autocorrelated intra-week returns. Approach B on non-overlapping periods is more honest.",
      "resume_from": "architect",
      "research_needed": false
    }
  ],
  "previous_feedback": {
    "attempt": 1,
    "gate1_passed": false,
    "gate3_nominal_passed": "3/4",
    "gate3_substantive_passed": "0/4",
    "root_cause": "Model collapsed to trivial always-positive prediction due to overlapping targets + excessive regularization + biased objective function",
    "key_evidence": [
      "100% positive predictions, only 10 unique values out of 457 test samples",
      "DA = naive always-up DA in all splits (0.00pp delta)",
      "0 trades during entire test period",
      "All top-5 Optuna trials have identical val_da = 53.07% = naive",
      "Bootstrap confidence near 1.0 for all predictions (5 models are nearly identical)"
    ]
  }
}
