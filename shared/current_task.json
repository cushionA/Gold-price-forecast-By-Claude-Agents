{
  "feature": "real_rate",
  "attempt": 4,
  "phase": "smoke_test",
  "source": "evaluator",
  "approach": "pca_multi_country_or_smoothed_transformer",

  "objective": "Extract robust economic signals from multi-country real rate data that improve meta-model performance without degrading MAE. Address the fundamental problem of monthly-to-daily frequency mismatch.",

  "requirements": "Build a submodel that either: (A) Uses PCA/ICA on multi-country monthly real rate changes to extract 2-3 principal components, with smooth daily interpolation, OR (B) Retains the Attempt 3 Transformer but applies output smoothing (cubic spline or first-difference) and feature selection (keep only sem_2, sem_3). The chosen approach must not degrade MAE in the Gate 3 ablation test.",

  "previous_feedback": {
    "attempt_1": {
      "architecture": "MLP Autoencoder (US-only)",
      "gate1": false,
      "gate2": true,
      "gate3": false,
      "failures": ["overfit_ratio=2.69", "autocorr>0.99", "identity_mapping", "gate3_no_improvement"],
      "successes": ["MI_increase=18.5%", "VIF<10", "correlation_stable"],
      "diagnosis": "Single-country MLP overfits and learns identity mapping."
    },
    "attempt_2": {
      "architecture": "GRU Autoencoder (US-only)",
      "gate1": null,
      "gate2": null,
      "gate3": null,
      "failures": ["optuna_all_trials_pruned", "gru_convergence_failure"],
      "diagnosis": "GRU failed to converge. Single-country approach insufficient."
    },
    "attempt_3": {
      "architecture": "Multi-Country Transformer Autoencoder (GPU)",
      "gate1": true,
      "gate2": true,
      "gate3": false,
      "failures": ["gate3_mae_degradation_all_folds", "gate3_da_marginal_miss", "gate3_sharpe_unstable"],
      "successes": ["overfit_ratio=1.28", "MI_increase=23.8%", "30_optuna_trials", "convergence_ok"],
      "key_metrics": {
        "overfit_ratio": 1.277,
        "mi_increase_pct": 23.84,
        "gate3_da_delta_cv": 0.004834,
        "gate3_sharpe_delta_cv": 0.276706,
        "gate3_mae_delta_cv": 0.417986
      },
      "diagnosis": "Multi-country Transformer solves overfitting and extracts more information (Gate 1/2 PASS). However, monthly-to-daily forward-fill creates step-function outputs that degrade MAE in all 5 CV folds. The information exists (23.8% MI increase) but the output format prevents XGBoost from exploiting it. Two of 5 semantic dimensions carry all the MI; the other 3 add pure noise.",
      "root_causes": [
        "Step-function output from forward-fill hurts point prediction (MAE)",
        "Only 188 monthly training samples for 98K-parameter model",
        "3 of 5 latent dimensions have zero mutual information with gold returns",
        "Synthetic real rates (0.49 correlation) add noise"
      ]
    },
    "pattern": "Three attempts show: (1) information exists in real rate features (Gate 2 passes consistently), (2) neural approaches struggle with small monthly samples, (3) output frequency mismatch is the critical bottleneck for Gate 3."
  },

  "recommended_approach": {
    "option_A": {
      "name": "PCA + Interpolation",
      "method": "PCA on standardized monthly multi-country real rate changes",
      "n_components": "2-3",
      "daily_alignment": "Cubic spline interpolation between monthly PC scores",
      "advantages": ["No overfitting (deterministic)", "Interpretable", "No training required", "Fast"],
      "risks": ["Linear method may miss nonlinear regime patterns"]
    },
    "option_B": {
      "name": "Smoothed Transformer Output",
      "method": "Reuse Attempt 3 model, but transform output: (1) keep only sem_2 and sem_3, (2) apply cubic spline interpolation instead of forward-fill",
      "advantages": ["Reuses existing trained model", "Preserves nonlinear patterns"],
      "risks": ["Still relies on 188-sample training"]
    },
    "recommendation": "Option A (PCA) is preferred: deterministic, no overfitting risk, and simpler. If PCA fails Gate 3, declare no_further_improvement and proceed."
  },

  "constraints": [
    "Output must not degrade MAE in Gate 3 ablation",
    "Use multi-country data from Attempt 3 data pipeline",
    "Smooth or interpolate monthly values to daily (no step functions)",
    "2-3 output dimensions maximum",
    "Time-series split: train 70% / val 15% / test 15%"
  ],

  "success_criteria": {
    "gate1": "overfit_ratio < 1.5 (or N/A for PCA)",
    "gate2": "MI increase > 5%",
    "gate3": "Any one of: DA +0.5%, Sharpe +0.05, MAE -0.01%. CRITICAL: MAE must not worsen."
  },

  "fallback_plan": {
    "if_attempt_4_fails": "Declare no_further_improvement for real_rate. The base real_rate feature already provides direct information. Proceed to dxy submodel.",
    "reason": "4 attempts is substantial investment. If PCA with interpolation cannot pass Gate 3, the marginal value of real_rate submodel is insufficient to justify further attempts."
  },

  "created_at": "2026-02-14T18:30:00"
}
