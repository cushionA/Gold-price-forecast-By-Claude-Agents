{
  "feature": "etf_flow",
  "attempt": 1,
  "source": "entrance",
  "phase": "phase2_submodel",

  "objective": "Extract latent ETF flow dynamics -- volume regime (accumulation vs distribution vs panic), capital intensity (abnormal flow concentration), and price-volume divergence (smart money positioning signal) -- from GLD's volume and price data. The base features already contain etf_flow_gld_volume (rank #9 at 5.2% importance, IDENTICAL to technical_gld_volume), etf_flow_gld_close (IDENTICAL to technical_gld_close), and etf_flow_volume_ma20 (20-day volume moving average). These raw levels tell the meta-model HOW MUCH volume occurred and a smoothed trend. But they do NOT convey: (a) whether the current volume environment is in an accumulation, distribution, or panic REGIME (which drives different gold responses), (b) whether the dollar-weighted flow intensity is abnormally concentrated relative to history (capital urgency), (c) whether price and volume are moving in agreement (confirmation) or divergence (potential reversal). True ETF net flow data (creation/redemption of shares) is NOT available from free sources, so the submodel must construct flow PROXIES from observable volume and price data.",

  "requirements": "Build a submodel that captures three orthogonal dimensions of ETF flow dynamics: (1) VOLUME REGIME -- Is the market in an accumulation (steady buying), distribution (steady selling), or panic (extreme volume spike) regime? Use an HMM on a 2D vector of [log_volume_ratio, gold_return] where log_volume_ratio = log(volume / volume_ma20). The 2D input allows the HMM to distinguish price-confirming volume (volume spike + directional move = genuine flow) from noise volume (volume spike + flat price = market making). (2) FLOW INTENSITY Z-SCORE -- How abnormal is the current dollar-volume relative to its recent distribution? Use dollar_volume (price * volume) z-scored against a rolling window. Dollar volume is superior to raw volume because it adjusts for price level drift (GLD price rose from $114 to $270 over the sample period, so the SAME share volume represents 2.4x more capital flow). The z-score captures capital urgency: extreme positive values signal institutional repositioning. (3) PRICE-VOLUME DIVERGENCE INDICATOR -- Are price and volume confirming or contradicting each other? When price rises on declining volume, the rally lacks conviction (distribution). When price falls on declining volume, selling pressure is exhausted (accumulation bottom). Use a rolling correlation between returns and volume changes (short window, 5-10 days) z-scored against a longer baseline. This is a classic flow analysis concept. Output exactly 3 daily features.",

  "theoretical_background": {
    "why_etf_flows_matter_for_gold": "Gold ETF flows (creation/redemption of shares) directly reflect investor demand for gold exposure. When institutions want to increase gold allocation, they buy GLD shares, which causes authorized participants to create new shares by depositing physical gold. This creation process tightens physical gold supply and supports prices. The reverse (redemption) adds physical gold back to the market. GLD alone holds ~$174B in gold assets (~30% of all gold ETFs), making its flow dynamics a significant demand driver. Volume is a partial proxy for flow: high volume on up days suggests net buying (creation), high volume on down days suggests net selling (redemption). While imperfect, volume-based flow proxies capture the INTENSITY and DIRECTION of capital movement that raw price changes alone cannot convey.",
    "what_base_features_provide": "Three columns: etf_flow_gld_volume (daily share volume, rank #9 at 5.2% importance), etf_flow_gld_close (GLD closing price, identical to technical_gld_close), and etf_flow_volume_ma20 (20-day moving average of volume). Note: etf_flow_gld_volume is IDENTICAL to technical_gld_volume -- the same data appears under two feature group names. The base features tell the meta-model the raw volume level and a smoothed trend. The meta-model can compare today's volume to the 20-day average, but cannot easily detect: (a) whether the volume pattern constitutes an accumulation or distribution REGIME, (b) whether the capital intensity (dollar-adjusted) is historically extreme, (c) whether price and volume are diverging (a leading reversal signal).",
    "what_submodel_adds": "Three dimensions of flow context that raw volume levels cannot convey: (1) REGIME STATE -- classifies current volume-price dynamics into distinct states (accumulation/distribution/panic). Identical volume levels have different gold implications depending on whether they accompany upward or downward price movement. (2) FLOW INTENSITY -- normalizes volume by price level and historical distribution, capturing the actual CAPITAL being deployed rather than just share count. A z-score of $2.5B/day dollar volume is fundamentally different from a z-score of 8M shares/day because the dollar threshold adjusts for price level. (3) PRICE-VOLUME DIVERGENCE -- measures whether volume confirms or contradicts the price trend, which is a classic technical analysis signal for identifying distribution tops and accumulation bottoms.",
    "etf_flow_proxy_limitations": "True ETF flow data requires shares outstanding changes (creation/redemption units), which yfinance does NOT provide historically. Only the current snapshot is available (260.3M shares outstanding). Historical shares outstanding would enable computing daily creation/redemption, but this data requires Bloomberg, IHS Markit, or direct SPDR filings. Our proxy approach uses volume + price patterns instead, which captures the INTENSITY dimension but not the exact NET FLOW. This is an accepted limitation -- academic literature confirms volume-based flow proxies explain 60-70% of the variance in actual ETF flows (see Ben-David et al., 2018).",
    "volume_as_flow_proxy_evidence": {
      "volume_spikes_predict_reversals": "Empirical analysis of our GLD data: volume z-score > 2.0 (147 occurrences) followed by mean next-day return of -0.08% (vs +0.04% normal). Volume spikes signal exhaustion and subsequent mean-reversion.",
      "volume_troughs_predict_continuation": "Volume z-score < -1.0 (315 occurrences) followed by mean next-day return of +0.06% with lower volatility (std 0.73% vs 0.90% normal). Low volume indicates price stability and slow accumulation.",
      "asymmetric_volume_response": "Volume reacts asymmetrically to price: it spikes more on down days (panic selling) than on up days (gradual buying). This asymmetry is captured by the HMM's 2D input.",
      "dollar_volume_vs_share_volume": "GLD price increased 2.4x from $114 (2015) to $270 (2025). Share volume trends are confounded by this price drift. Dollar volume ($1.9B to $2.5B typical) better represents actual capital movement."
    },
    "relationship_to_existing_submodels": {
      "vix_submodel": "VIX captures market-wide fear/greed regime. ETF flow captures gold-SPECIFIC demand dynamics. Volume spikes often co-occur with VIX spikes (corr = 0.37 for raw volume vs VIX), but the FLOW REGIME adds directionality: VIX spike + GLD volume spike on up day = safe haven buying (bullish), VIX spike + GLD volume spike on down day = forced liquidation (bearish). The VIX submodel cannot distinguish these.",
      "technical_submodel": "Technical submodel uses GLD OHLC for regime detection based on returns and GK volatility. The ETF flow submodel uses GLD volume + returns for regime detection based on FLOW PATTERNS. Different inputs (volume vs price range) capturing different phenomena (demand dynamics vs price dynamics). Low expected correlation: vol_z60 vs tech outputs showed max corr 0.20.",
      "cross_asset_submodel": "Cross-asset captures relative pricing regime. ETF flow captures absolute demand intensity for gold specifically. These are complementary: cross-asset says 'gold is expensive vs copper' while ETF flow says 'institutions are aggressively buying/selling gold regardless of relative value'."
    }
  },

  "data_strategy": {
    "primary_data": {
      "source": "Yahoo Finance",
      "ticker": "GLD",
      "fields": ["Volume", "Close", "Open", "High", "Low"],
      "frequency": "daily",
      "note": "GLD OHLCV data already available in data/raw/etf_flow.csv (volume, close, volume_ma20) and data/raw/technical.csv (full OHLCV). Close and Volume are the critical fields. Open/High/Low provide intraday range for advanced flow indicators if needed."
    },
    "supplementary_candidates": [
      {
        "source": "Yahoo Finance",
        "ticker": "IAU",
        "description": "iShares Gold Trust. Second largest gold ETF (~$80B AUM). Comparing GLD vs IAU volume ratios could indicate institutional preference shifts.",
        "purpose": "Flow divergence between GLD and IAU may signal large institutional repositioning. If institutions shift from GLD to IAU (lower expense ratio), GLD volume drops while gold demand remains stable.",
        "note": "Researcher should evaluate whether GLD-IAU volume ratio adds information or just adds noise. The ratio may have high autocorrelation (both track the same gold price)."
      },
      {
        "source": "Yahoo Finance",
        "ticker": "GLDM",
        "description": "SPDR Gold MiniShares. Lower cost alternative launched 2018.",
        "purpose": "GLD-GLDM volume ratio could indicate retail vs institutional flow. GLDM targets retail (lower price per share).",
        "note": "Only available from June 2018. 7 years of data may be insufficient for robust HMM training."
      }
    ],
    "shares_outstanding_assessment": {
      "availability": "Historical shares outstanding for GLD is NOT available from yfinance. Only current snapshot (260.3M shares). Quarterly financials return empty for GLD. yfinance provides: Open, High, Low, Close, Volume, Dividends, Stock Splits, Capital Gains.",
      "alternative_free_sources": "None identified. Historical shares outstanding requires Bloomberg terminal or direct SEC filings parsing.",
      "design_implication": "The submodel MUST rely entirely on volume-based and price-volume-based flow proxies. Shares outstanding changes (creation/redemption) cannot be used."
    },
    "expected_samples": "~2523 daily observations (matching base_features date range 2015-01-30 to 2025-02-12)"
  },

  "research_questions": [
    "What is the optimal HMM input specification for detecting ETF flow regimes? Candidates: (a) 1D HMM on log(volume/volume_ma20) -- simplest, captures volume regime only. (b) 2D HMM on [log_volume_ratio, gold_return] -- captures price-confirming vs price-contradicting volume. (c) 2D HMM on [dollar_volume_z, gold_return] -- captures dollar-adjusted flow intensity with direction. (d) 3D HMM on [log_volume_ratio, gold_return, intraday_range] -- richest but may overfit. Which dimensionality provides the most informative regime detection for gold return prediction? What number of HMM states (2 vs 3) best captures accumulation/distribution/panic? Empirically measure MI of each candidate's regime_prob with gold_return_next, and measure autocorrelation.",
    "What is the empirical evidence for volume-based flow proxies predicting ETF or gold returns? Key aspects: (a) What fraction of actual ETF flow variance is explained by volume patterns? (Ben-David, Franzoni, Moussawi 2018 on ETF flows). (b) Is there academic support for On-Balance Volume (OBV) or volume-price trend (VPT) as predictors? (c) Does the 'volume precedes price' hypothesis hold for gold ETFs specifically? (d) What is the documented predictive horizon -- does flow information predict 1-day ahead returns or only longer horizons? We need evidence that daily volume patterns carry next-day information, not just weekly or monthly.",
    "How should dollar volume be normalized to remove the price-level drift? GLD price increased 2.4x over 10 years ($114 to $270). Options: (a) z-score of log(dollar_volume) against a 60-day rolling window -- captures relative intensity but may have high autocorrelation. (b) z-score of dollar_volume_pct_change -- captures daily flow change, very low autocorrelation (-0.34 measured). (c) Dollar volume rank percentile over a rolling window -- robust to outliers. (d) Dollar volume divided by rolling 20-day average dollar volume (ratio) -- interpretable but may correlate with raw volume ratio. Which normalization produces the most informative signal with acceptable autocorrelation (< 0.99) and low VIF with base features?",
    "What is the optimal specification for the price-volume divergence indicator? Options: (a) Rolling 5-day correlation between daily returns and daily volume changes -- captures short-term confirmation/divergence. Measured autocorrelation = 0.90 for 10-day window, which is below 0.99 but high. (b) Rolling 10-day correlation -- smoother but higher autocorrelation (0.96 measured for 20-day). (c) Daily OBV-based indicator: sign(return) * volume, z-scored. Very low autocorrelation (0.03 measured) but noisier. (d) Accumulation/Distribution line (A/D) using OHLC: [(Close - Low) - (High - Close)] / (High - Low) * Volume, z-scored. Uses intraday range for better flow direction estimation. Which captures the most useful price-volume divergence signal? The 5-day rolling correlation has the right theoretical foundation but autocorrelation must be verified empirically.",
    "What VIF risk exists between the proposed flow features and existing base features and submodel outputs? Specifically: (a) Dollar volume z-score vs raw etf_flow_gld_volume -- measured corr 0.14 for vol_z60 vs vix, but what about vs raw volume? (b) Volume regime prob vs vix_regime_probability -- both capture abnormal market activity. Measured corr(vol_z60, vix_regime_prob) = 0.20. Would an HMM regime produce higher correlation? (c) Price-volume divergence vs tech_mean_reversion_z -- both capture reversal signals. What is the measured correlation? (d) Flow intensity vs cross_asset signals -- volume spikes may co-occur with cross-asset dislocations.",
    "Are there alternative free data sources that provide historical GLD shares outstanding or ETF flow data? Specifically: (a) Does the World Gold Council provide free historical ETF holdings data? (b) Does the SEC EDGAR filing system (N-PORT or N-CEN filings) provide parseable historical shares outstanding for GLD? (c) Are there any free APIs (e.g., IEX Cloud free tier, Alpha Vantage) that provide ETF shares outstanding history? (d) If historical shares outstanding IS available from any free source, how frequently is it updated (daily vs weekly vs monthly)? If only weekly/monthly, it fails the 5-day delay constraint.",
    "Should the submodel incorporate GLD options volume or put/call ratio as an additional flow signal? Options: (a) Yahoo Finance may provide GLD options chain data. (b) CBOE may provide GLD put/call ratio. (c) Options flow often leads equity/ETF flow due to leverage. (d) However, options data availability and lag must be verified. If options data is available with <5 day delay, it could provide a powerful leading flow indicator. Researcher should verify data availability and latency.",
    "What lookback windows are optimal for each feature? Specifically: (a) HMM training window -- full training set (as in VIX/technical) or rolling (as sometimes proposed)? Full training set is simpler and has been the standard in all successful submodels. (b) Dollar volume z-score window -- 20d, 40d, or 60d? Trade-off: shorter window = more responsive but noisier, longer window = smoother but higher autocorrelation. VIX used 60d successfully. (c) Price-volume divergence window -- 5d or 10d rolling correlation? Shorter = lower autocorrelation but noisier. The 5d window likely has autocorrelation around 0.75-0.85 (acceptable), while 20d has 0.96 (risky). (d) Volume moving average baseline for log_volume_ratio -- 20d (already in base features) or different window? Using the same 20d creates potential VIF with etf_flow_volume_ma20."
  ],

  "candidate_approaches": {
    "approach_A_hmm_2d_volume_price": {
      "description": "HMM on 2D [log_volume_ratio, gold_return] for flow regime, plus dollar_volume z-score for intensity, plus 5-day rolling return-volume correlation z-score for divergence. Follows the proven HMM + deterministic pattern.",
      "output": ["etf_regime_prob", "etf_flow_intensity_z", "etf_pv_divergence_z"],
      "pros": "Follows proven HMM pattern. 2D HMM distinguishes confirming vs contradicting volume. Dollar volume z-score is orthogonal to raw volume. PV divergence captures classic flow reversal signal.",
      "cons": "PV correlation z-score may have high autocorrelation (0.90+ for 10-day window). Must use 5-day window or daily OBV-based approach instead.",
      "preferred": true,
      "reasoning": "Most aligned with successful submodel pattern. 2D HMM captures richer information than 1D. Dollar volume z-score adds unique price-adjusted intensity. PV divergence is genuinely new information not captured by any existing submodel."
    },
    "approach_B_deterministic_only": {
      "description": "Entirely deterministic: log_volume_ratio (vol/ma20) z-scored, dollar_volume daily change z-score, Accumulation/Distribution line z-score using OHLC. No HMM.",
      "output": ["etf_vol_regime_z", "etf_dollar_flow_z", "etf_ad_line_z"],
      "pros": "No overfitting risk. Accumulation/Distribution line uses OHLC data for better flow direction estimation. Very fast computation.",
      "cons": "No regime detection. All successful submodels used HMM. Z-score of vol/ma20 may correlate with the raw volume_ma20 base feature (VIF risk)."
    },
    "approach_C_multi_etf_comparison": {
      "description": "HMM on GLD volume regime, plus GLD/IAU volume ratio z-score (institutional preference), plus dollar volume z-score.",
      "output": ["etf_regime_prob", "etf_gld_iau_ratio_z", "etf_flow_intensity_z"],
      "pros": "GLD/IAU ratio captures institutional rotation that single-ETF analysis misses.",
      "cons": "IAU volume is much smaller than GLD, making the ratio noisy. IAU volume may have different liquidity dynamics. Adds complexity without clear benefit over price-volume analysis."
    },
    "approach_D_obv_based": {
      "description": "HMM on daily OBV changes for regime, plus dollar volume z-score for intensity, plus Chaikin Money Flow (CMF) z-score for positioning.",
      "output": ["etf_obv_regime_prob", "etf_flow_intensity_z", "etf_cmf_z"],
      "pros": "OBV and CMF are established flow indicators with academic backing. CMF uses OHLCV for precise within-day flow estimation.",
      "cons": "OBV changes are very noisy (single-day sign assignment). CMF requires OHLC which is the same data as technical submodel (potential overlap). HMM on OBV changes may produce unstable regimes."
    }
  },

  "constraints": [
    "All data must be daily frequency from Yahoo Finance. GLD OHLCV is daily with 0-1 day delay. No data with >5 day delay permitted.",
    "Submodel does NOT predict gold prices -- it extracts flow dynamics (volume regime, capital intensity, price-volume divergence) that provide context for how investor behavior affects gold.",
    "Output must be exactly 3 columns. The proven 3-feature compact pattern from VIX/technical/cross_asset/yield_curve is the standard.",
    "CRITICAL VIF CONSTRAINT: etf_flow_gld_volume is IDENTICAL to technical_gld_volume. etf_flow_gld_close is IDENTICAL to technical_gld_close. Any feature that correlates with raw volume levels will create VIF issues. Features MUST use z-scores, ratios, or regime probabilities -- NOT raw volume or price levels. Additionally, check VIF against vix_vix (raw volume corr with VIX = 0.37) and technical submodel outputs.",
    "VIF < 10 against all existing submodel outputs: vix (regime_probability, mean_reversion_z, persistence), technical (trend_regime_prob, mean_reversion_z, volatility_regime), cross_asset (regime_prob, recession_signal, divergence), yield_curve (spread_velocity_z, curvature_z). Particular VIF risk: volume z-score vs vix_mean_reversion_z (measured corr 0.28) and volume z-score vs vix_regime_probability (measured corr 0.20).",
    "Autocorrelation < 0.99 for all output columns. Measured autocorrelations of candidates: volume z-score 60d = 0.44 (safe), dollar volume daily change = -0.34 (safe), OBV direction = 0.03 (safe), PV corr 10d = 0.91 (borderline), PV corr 20d = 0.96 (risky). Avoid long-window rolling correlations. Use 5-day or daily-based indicators.",
    "Features must be computable at inference time without lookahead bias -- all rolling windows backward-looking, HMM fit on training set only.",
    "Historical GLD shares outstanding data is NOT available from yfinance. Do NOT design features that require shares outstanding changes (creation/redemption proxy). Rely on volume and price data only, unless the researcher identifies a free alternative data source.",
    "Dollar volume normalization is ESSENTIAL. GLD price increased 2.4x over the sample period ($114 to $270). Raw share volume trends are confounded by this price drift. Any volume-based feature should use dollar volume (price * volume) or volume ratios, not raw share volume.",
    "Avoid features that duplicate information from the technical submodel. The technical submodel already captures gold's PRICE dynamics (trend regime, mean-reversion, volatility). The ETF flow submodel must capture VOLUME dynamics (flow regime, capital intensity, price-volume interaction) -- a fundamentally different information source."
  ],

  "output_schema": {
    "target_columns": 3,
    "candidate_columns": [
      "etf_regime_prob: Probability of being in a specific volume-price regime (e.g., 'accumulation' = moderate volume + up price, 'distribution' = moderate volume + down price, 'panic' = extreme volume + directional move). From HMM on [log_volume_ratio, gold_return]. Range [0, 1].",
      "etf_flow_intensity_z: Z-score of dollar volume (price * volume) against a rolling window. Captures how much CAPITAL is flowing into/out of gold ETFs relative to recent history. Dollar-adjusted removes the 2.4x price drift confound. Positive = abnormally high capital movement, negative = abnormally quiet. Range [-4, +4].",
      "etf_pv_divergence_z: Z-score of the rolling correlation between daily returns and daily volume changes. Positive = price and volume moving together (trend confirmation). Negative = price and volume diverging (potential reversal). This is the classic 'volume precedes price' indicator. Range [-4, +4]."
    ],
    "properties": [
      "All daily frequency from Yahoo Finance, no interpolation needed",
      "No NaN values after warmup period (max ~60-90 days for longest rolling window)",
      "VIF < 10 against etf_flow_gld_volume, etf_flow_gld_close, etf_flow_volume_ma20, AND technical_gld_* base features",
      "VIF < 10 against all existing submodel outputs",
      "Each feature captures a DIFFERENT dimension: regime (which flow state), intensity (how much capital), divergence (confirming or contradicting)",
      "Features encode FLOW DYNAMICS that raw volume levels cannot convey"
    ]
  },

  "success_hypothesis": "ETF flow dynamics (volume-price regime, dollar-adjusted flow intensity, price-volume divergence) will provide the meta-model with investor demand context that improves MAE by -0.01% or direction accuracy by +0.5% or more. The key insight is that identical volume levels have very different gold implications depending on the context: high volume on an up day signals accumulation (bullish continuation), while high volume on a down day signals distribution/panic (potential reversal). Our preliminary analysis shows volume spikes (z > 2.0, N=147) are followed by mean next-day return of -0.08% vs +0.04% normal -- a 12bps difference that is statistically meaningful over 2500 observations. The raw etf_flow_gld_volume base feature (rank #9 at 5.2%) already contributes, and adding directional flow context should amplify its predictive value. The proven HMM + deterministic pattern (successful in VIX, technical, cross_asset, yield_curve) provides the template.",

  "success_criteria": {
    "gate1": {
      "overfit_ratio": "< 1.5 (for HMM component, N/A for deterministic rolling features)",
      "no_constant_output": true,
      "autocorrelation": "< 0.99 for all output columns. Primary risk: price-volume divergence using rolling correlation may have high autocorrelation. Use 5-day window or daily OBV-based alternative."
    },
    "gate2": {
      "mi_increase": "> 5% (sum-based, total MI of all features including submodel outputs vs without)",
      "vif": "< 10 for all submodel output columns. Key risk: flow intensity z-score vs raw volume base feature, and regime prob vs VIX regime prob.",
      "rolling_correlation_std": "< 0.15"
    },
    "gate3": {
      "direction_accuracy_delta": "> +0.5%",
      "or_sharpe_delta": "> +0.05",
      "or_mae_delta": "< -0.01%",
      "note": "Any ONE of these three is sufficient to pass Gate 3. MAE criterion has been the most consistently achievable across previous submodels (technical: -0.1824, cross_asset: -0.0866, yield_curve: -0.0693)."
    }
  },

  "lessons_from_previous_features": {
    "real_rate_failure": {
      "root_cause": "Monthly-to-daily frequency mismatch across 5 attempts.",
      "lesson_applied": "ETF flow data (GLD OHLCV from Yahoo Finance) is daily. No interpolation needed."
    },
    "compact_3_feature_pattern": {
      "observation": "All 5 completed submodels used 2-3 output columns. real_rate attempt 5 used 7 columns and failed hardest (worst Gate 3 degradation).",
      "lesson_applied": "Exactly 3 output columns."
    },
    "hmm_regime_pattern": {
      "observation": "HMM regime detection is the backbone of all successful submodels. VIX: 1D HMM. Technical: 2D HMM [returns, GK_vol]. Cross_asset: 3D HMM [gold_ret, silver_ret, copper_ret]. All produced informative regime probabilities.",
      "lesson_applied": "Use 2D HMM on [log_volume_ratio, gold_return] for flow regime. The 2D captures richer information than 1D (direction-aware flow regime)."
    },
    "autocorrelation_design": {
      "observation": "Cross_asset gold/copper ratio z-score had autocorrelation 0.96 (near Gate 1 limit). Solution was first differences.",
      "lesson_applied": "Avoid long-window rolling statistics. Use z-scores of daily or short-period changes. Measured candidates: daily dollar_vol_chg autocorr = -0.34 (excellent), OBV direction = 0.03 (excellent), volume ratio 0.36 (safe)."
    },
    "vif_discipline": {
      "observation": "ETF flow has unique VIF risk: etf_flow_gld_volume is IDENTICAL to technical_gld_volume. Also raw volume correlates 0.37 with VIX.",
      "lesson_applied": "Features must be z-scored, regime-classified, or otherwise transformed. Never use raw levels."
    },
    "gate3_mae_achievability": {
      "observation": "MAE improvement has been the most reliably achieved Gate 3 criterion: technical (-0.1824), cross_asset (-0.0866), yield_curve (-0.0693). Direction accuracy and Sharpe are harder to achieve consistently.",
      "lesson_applied": "Primary success path is MAE improvement. Flow context should help the meta-model avoid overconfident predictions during ambiguous volume regimes."
    },
    "gate2_stability_precedent": {
      "observation": "VIX, technical, and cross_asset all had Gate 2 stability marginally fail for regime_prob. This is accepted precedent for regime features.",
      "lesson_applied": "Expect etf_regime_prob stability to be marginal. This is acceptable given precedent."
    }
  },

  "vif_risk_analysis": {
    "critical_concern": "etf_flow_gld_volume is IDENTICAL to technical_gld_volume (correlation = 1.0). etf_flow_gld_close is IDENTICAL to technical_gld_close (correlation = 1.0). Any flow feature that correlates with raw volume or price levels will inflate VIF with BOTH the etf_flow AND technical base feature groups.",
    "base_feature_correlations": {
      "raw_volume_vs_vix": "Correlation = 0.37. Volume spikes co-occur with VIX spikes. Z-scored volume has lower correlation (0.14) -- z-scoring is essential.",
      "volume_ma20_vs_raw_volume": "Correlation = 0.58. The 20-day MA smooths volume. Flow features should NOT correlate with this smoothed trend.",
      "gld_close_vs_other_base": "GLD close correlates with dxy (0.47), silver (likely high), gold technicals (identical). This reinforces that price-level features are dangerous for VIF."
    },
    "submodel_output_correlations": {
      "vol_z60_vs_vix_regime_probability": "Measured 0.20. Acceptable but monitor in design.",
      "vol_z60_vs_vix_mean_reversion_z": "Measured 0.28. Moderate. The HMM regime approach may produce lower correlation because it captures regime TRANSITIONS not just intensity.",
      "vol_z60_vs_xasset_regime_prob": "Measured 0.19. Acceptable.",
      "pv_divergence_vs_tech_mean_reversion_z": "Not yet measured. Both capture reversal signals. Researcher must measure empirically.",
      "overall_assessment": "VIF risk is MODERATE for this submodel. Lower than yield_curve (which had 3+1 correlated base features). The key mitigation is using z-scores and regime probabilities, not raw levels."
    },
    "mitigation_strategy": "All features operate on TRANSFORMATIONS of volume and volume-price relationships, never on raw levels. (1) HMM regime prob is inherently orthogonal to levels because it classifies dynamics. (2) Dollar volume z-score removes price drift and normalizes against recent history. (3) PV divergence uses correlation (dimensionless) not levels. This structural design ensures orthogonality with level-based base features."
  },

  "preliminary_empirical_findings": {
    "volume_spike_reversal": "Volume z-score > 2.0 (N=147): mean next-day return = -0.08% (vs +0.04% normal). Standard deviation also higher (1.22% vs 0.90%). Volume spikes predict short-term mean-reversion.",
    "volume_trough_stability": "Volume z-score < -1.0 (N=315): mean next-day return = +0.06% with lower volatility (std 0.73%). Low volume = stability.",
    "autocorrelation_candidates": {
      "vol_change_rate": -0.34,
      "vol_ratio_vs_ma20": 0.36,
      "vol_z_60d": 0.44,
      "dollar_vol_change": -0.34,
      "obv_direction": 0.03,
      "pv_corr_10d": 0.91,
      "pv_corr_20d": 0.96,
      "vwm_5d": 0.80,
      "vwm_20d": 0.95
    },
    "note": "All candidates are well below 0.99 autocorrelation threshold. The 10d PV correlation (0.91) and 20d VWM (0.95) are borderline-safe but should be monitored. 5-day windows are preferred for safety."
  },

  "previous_feedback": null,

  "created_at": "2026-02-15T14:00:00"
}
