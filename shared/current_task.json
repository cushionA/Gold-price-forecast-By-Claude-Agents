{
  "feature": "dxy",
  "attempt": 1,
  "source": "entrance",
  "phase": "phase2_submodel",

  "summary": "DXY submodel proper construction. Previous attempt 1 was auto-evaluated (MI=0.019) without Gate 2/3 testing and its output was never incorporated into the meta-model. The meta-model currently uses only dxy_change (base feature, importance rank #17 at 3.50%). DXY is gold's strongest inverse correlator and deserves a proper submodel to extract regime, divergence, and volatility context.",

  "requirements": "Build a Deterministic HMM-based submodel that extracts USD regime dynamics, cross-currency structure, and FX volatility state from DXY and its 6 constituent currency pairs. Output 2-3 columns following the proven success pattern (Deterministic HMM with 3-state regime + z-score features). All data is daily frequency -- no interpolation required.",

  "approach": "Deterministic HMM + Cross-Currency Z-Score Features (Proven Pattern)",

  "why_dxy_matters": {
    "theoretical_background": "Gold is priced in USD, creating a mechanical inverse relationship. When USD strengthens (DXY rises), gold becomes more expensive for non-USD buyers, reducing demand. Conversely, USD weakness signals monetary easing or loss of confidence, driving gold demand as a store of value. However, this inverse correlation is regime-dependent: during crises, both USD and gold can rise as safe havens. The raw dxy_change base feature captures only the directional move but not the context (is it broad-based USD strength? EUR-driven? Is the USD in a trending or mean-reverting regime?).",
    "current_gap": "The meta-model sees dxy_change (rank #17, 3.50% importance) -- a raw daily change with no contextual information. Other features like dxy_dxy (raw level) provide no regime or structural insight. The meta-model cannot distinguish between: (a) broad-based USD rally with all currencies moving together, (b) EUR-specific weakness driving DXY up while JPY/CHF strengthen, (c) high-volatility regime where DXY moves are larger and more persistent.",
    "expected_value_add": "A DXY submodel capturing regime state, cross-currency agreement/divergence, and USD volatility context gives the meta-model the ability to weight dxy_change appropriately based on the structural environment. This is analogous to how vix_regime_probability (rank #21, 3.38%) helps contextualize raw VIX, and how tech_trend_regime_prob (rank #1, 7.20%) helps contextualize gold technicals."
  },

  "data_sources": {
    "primary": {
      "DXY_index": "Yahoo: DX-Y.NYB (daily, already in data/raw/dxy.csv)"
    },
    "constituent_currencies": {
      "EURUSD": "Yahoo: EURUSD=X (57.6% weight, inverse to DXY)",
      "USDJPY": "Yahoo: JPY=X (13.6% weight, same direction as DXY)",
      "GBPUSD": "Yahoo: GBPUSD=X (11.9% weight, inverse to DXY)",
      "USDCAD": "Yahoo: CAD=X (9.1% weight, same direction as DXY)",
      "USDSEK": "Yahoo: SEK=X (4.2% weight, same direction as DXY)",
      "USDCHF": "Yahoo: CHF=X (3.6% weight, same direction as DXY)"
    },
    "frequency": "All daily. No interpolation needed (key advantage over real_rate).",
    "delay": "Same-day or T+1. Well within 5-day rule."
  },

  "proven_success_pattern": {
    "description": "The most successful submodel pattern in this project is Deterministic HMM (3-state) + domain-specific z-score features. This pattern has produced Gate 3 passes for: vix (DA +0.96%, Sharpe +0.289), cross_asset (DA +0.76%, MAE -0.0866), etf_flow (Sharpe +0.377, MAE -0.0436), inflation_expectation (DA +0.57%, Sharpe +0.152), and others.",
    "architecture": {
      "component_1": "3-state HMM on DXY daily returns -> dxy_regime_prob (probability of trending state)",
      "component_2": "Z-score feature capturing cross-currency divergence or DXY momentum persistence",
      "component_3_optional": "Z-score feature capturing FX volatility state (only if VIF allows)"
    },
    "output_columns": "2-3 columns: regime_prob + 1-2 z-score features",
    "why_this_works": "HMM regime_prob captures temporal state (trending vs consolidation vs crisis). Z-score features capture domain-specific dynamics. XGBoost can easily split on these well-scaled features. The 2-3 column constraint prevents noise overfitting (lesson from real_rate attempt 5: 7 columns = worst Gate 3 result)."
  },

  "candidate_output_features": {
    "column_1_regime_prob": {
      "name": "dxy_regime_prob",
      "method": "3-state Gaussian HMM on DXY daily log-returns",
      "description": "Probability of being in the high-variance (trending) regime. Captures whether USD is in a strong trend, low-volatility consolidation, or high-volatility crisis mode.",
      "range": "[0, 1]",
      "precedent": "vix_regime_probability, tech_trend_regime_prob, xasset_regime_prob, etf_regime_prob, ie_regime_prob -- all passed Gate 3"
    },
    "column_2_primary_candidate": {
      "name": "dxy_momentum_z",
      "method": "Z-score of DXY 20-day momentum (return over 20 days), normalized via expanding window",
      "description": "Captures whether USD is in a strong uptrend or downtrend relative to historical norms. Different from raw dxy_change (1-day) because it captures persistence of direction over a month.",
      "range": "unbounded, typically [-3, 3]",
      "why_preferred": "Simpler and more robust than PCA cross-currency divergence. The previous attempt 1's PCA divergence had scaling issues (many 0.0 values in early period). Momentum z-score is proven to work (similar to vix_mean_reversion_z, tech_mean_reversion_z)."
    },
    "column_3_alternative_candidates": {
      "option_a_volatility_z": {
        "name": "dxy_vol_z",
        "method": "Z-score of 20-day realized volatility of DXY returns",
        "risk": "May correlate with vix_regime_probability or vix_persistence. VIF must be checked."
      },
      "option_b_divergence": {
        "name": "dxy_cross_currency_div",
        "method": "Rolling PCA on 6 constituent currency returns. 1 - PC1_explained_variance_ratio.",
        "risk": "Previous attempt had many 0.0 values. May need different scaling or window."
      },
      "researcher_should_recommend": "Researcher should evaluate which option provides more unique information vs existing submodel features. VIF analysis is critical."
    }
  },

  "research_questions": [
    "What is the optimal number of HMM states for daily DXY returns? The project's proven pattern uses 3 states. Is 3 states appropriate for FX data, or should we test 2-4? What does the BIC/AIC suggest for DXY daily returns?",
    "What z-score features best capture DXY dynamics that are NOT already in the meta-model? The meta-model has dxy_change (1-day). Candidates: (a) 20-day momentum z-score, (b) realized vol z-score, (c) cross-currency divergence via PCA. Which provides the most unique information? Compute pairwise correlations against existing features (vix, vix_regime_probability, vix_persistence).",
    "Does cross-currency PCA divergence (1 - PC1_explained_variance) provide meaningful variation? The previous DXY attempt 1 output had many 0.0 values for dxy_cross_currency_div in the early period. Is this a data issue or is the feature inherently too stable? What rolling window (40/60/90 days) produces the best variation?",
    "What is the empirical VIF of dxy_momentum_z and dxy_vol_z against the existing 24 meta-model features? Specifically, correlations with: (a) dxy_change (1-day vs 20-day momentum -- should be moderate ~0.3-0.5), (b) vix_persistence (FX vol vs equity vol persistence), (c) yc_curvature_z (rate structure vs FX structure).",
    "For the 6 constituent DXY currencies, are there data quality issues on Yahoo Finance for USDSEK=X and USDCHF=X (lowest weights)? Should we simplify to top-4 currencies (EUR, JPY, GBP, CAD = 92.2% of DXY) to reduce data noise?",
    "What is the historical breakdown frequency of the DXY-gold inverse correlation? In what percentage of 60-day rolling windows does the correlation become positive? This informs whether the regime feature adds value for the meta-model."
  ],

  "constraints": [
    "5-day data delay rule: all Yahoo Finance currency data is same-day/T+1. Safe.",
    "Submodel does NOT predict gold prices. It extracts USD regime state, momentum persistence, and optionally cross-currency divergence.",
    "Output 2-3 columns maximum. The proven success pattern is regime_prob + 1-2 z-score features. More columns = more noise for XGBoost.",
    "All data is daily frequency. No interpolation of any kind.",
    "All normalizations must use expanding or rolling windows (no full-sample statistics). Causal computation only -- no lookahead.",
    "HMM must be trained with fixed random_state for reproducibility.",
    "Must pass VIF < 10 against all existing meta-model features. Key risk: dxy_vol_z may correlate with VIX-related features.",
    "Currency return direction normalization is CRITICAL: EURUSD and GBPUSD returns must be negated so positive = USD strength for all pairs.",
    "Use hmmlearn library (pip install hmmlearn in notebook). Proven to work on Kaggle.",
    "Must include dataset_sources: bigbigzabuton/gold-prediction-submodels in kernel-metadata.json."
  ],

  "lessons_from_previous_dxy_attempt": {
    "attempt_1_summary": "Auto-evaluated with MI=0.019. Training used GMM (not HMM), rolling PCA, and realized vol z-score. Output exists in data/submodel_outputs/dxy/submodel_output.csv but was NEVER used in the meta-model.",
    "issues_identified": [
      "PCA cross-currency divergence had many 0.0 values in early period (expanding MinMax scaling issue)",
      "GMM was used instead of HMM -- GMM does not capture temporal transitions between regimes",
      "The 3 output features were not tested in ablation (Gate 3) -- no evidence they improve meta-model",
      "MI=0.019 was very low compared to other submodels"
    ],
    "what_to_change": [
      "Switch from GMM to proper HMM (GaussianHMM) for regime detection",
      "Consider replacing PCA divergence with simpler momentum z-score (proven pattern)",
      "Ensure proper Optuna HPO (30 trials) for HMM n_components, n_init, windows",
      "Run full Gate 1/2/3 evaluation -- no auto-evaluation shortcuts"
    ]
  },

  "success_patterns_from_other_submodels": {
    "highest_gate3_successes": {
      "technical_mae": "-0.1824 (18x threshold) -- regime_prob rank #1 in importance (7.20%)",
      "options_market_mae": "-0.1562 (15.6x threshold) -- regime_prob rank #2 in importance (7.55%)",
      "etf_flow_sharpe": "+0.377 (7.5x threshold) -- dual pass on Sharpe and MAE",
      "inflation_expectation": "All 3 gates pass -- first and only submodel to achieve this (until temporal_context)"
    },
    "common_architecture": "HMM 3-state regime detection + 2 domain-specific z-score features = 3 output columns",
    "feature_importance_pattern": "regime_prob features consistently rank in top 10 (tech: #1, options: #2, xasset: #5, ie: #3, etf: #9). Z-score features add complementary information."
  },

  "success_hypothesis": "A DXY submodel following the proven Deterministic HMM pattern (3-state regime + momentum z-score + optional vol/divergence z-score) will provide the meta-model with USD structural context that distinguishes trending, consolidating, and crisis regimes. Expected: Gate 3 MAE improvement -0.01 or better (most achievable criterion based on 6 of 8 submodels passing via MAE). DXY is gold's strongest inverse correlator, and even modest regime context should help XGBoost use dxy_change more effectively.",

  "success_criteria": {
    "gate1_standalone_quality": "Overfit ratio < 1.5 (HMM is generative, not predictive -- should pass easily). No constant output. Autocorrelation < 0.99.",
    "gate2_information_gain": "MI total increase > 5%. VIF < 10 for all output columns. Rolling correlation std < 0.15.",
    "gate3_ablation": "Any one of: DA +0.5%, Sharpe +0.05, MAE -0.01. Based on precedent, MAE improvement is the most likely criterion to pass."
  },

  "fallback_plan": {
    "if_3_columns_fail_gate3": "Reduce to 2 columns (regime_prob + best z-score). Drop the least important feature.",
    "if_hmm_fails_gate1": "Use deterministic threshold-based regime detection (sigmoid of 20-day momentum / 20-day std) as regime proxy.",
    "if_vif_fails": "Residualize violating feature against base features. Or drop and keep only 2 columns.",
    "max_attempts": "2-3 attempts maximum. DXY should be straightforward given daily data frequency."
  },

  "meta_model_context": {
    "current_best": "Attempt 7: DA 60.04%, HCDA 64.13%, Sharpe 2.46, MAE 0.94%",
    "targets_passed": "3/4 (DA, HCDA, Sharpe). MAE structurally infeasible with current test set.",
    "n_features": 24,
    "dxy_change_current_importance": "rank #17 of 22, 3.50% importance -- lowest among base features",
    "potential_impact": "If DXY submodel features reach similar importance to other regime_prob features (5-8%), it could improve DA or MAE. However, attempts 8-10 showed that adding features does not guarantee improvement -- the feature must add genuine signal, not noise."
  },

  "previous_feedback": {
    "auto_evaluation_note": "DXY attempt 1 was auto-evaluated with MI=0.019 and marked 'completed' without Gate 2/3 testing. This was a shortcut that should be corrected. The output was never incorporated into the meta-model.",
    "meta_model_attempt_10_lesson": "Adding cny_demand_spread_z (1 feature) to meta-model attempt 10 ranked last (25/25) and degraded all metrics. New features must demonstrate genuine signal, not just exist."
  },

  "output_specification": {
    "format": "CSV with Date column + 2-3 feature columns",
    "naming_convention": "dxy_regime_prob, dxy_momentum_z, [dxy_vol_z or dxy_cross_currency_div]",
    "value_range": "regime_prob: [0,1]; z-scores: typically [-3, 3]",
    "expected_rows": "~2500 (matching base_features date range 2015-01-30 to 2025-02-12)",
    "nan_handling": "First ~60 rows may be NaN due to warmup. Fill with 0 for z-scores, 0.5 for regime_prob.",
    "save_path": "data/submodel_outputs/dxy.csv"
  },

  "created_at": "2026-02-17T23:30:00",
  "created_by": "entrance"
}
