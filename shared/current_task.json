{
  "feature": "yield_curve",
  "attempt": 1,
  "source": "entrance",
  "phase": "phase2_submodel",

  "objective": "Extract latent yield curve DYNAMICS -- the shape regime (steepening/flattening/inverting), the rate of change of the term structure, and the curvature or convexity signal -- from the 10Y-2Y spread and its constituent yields. The base features already contain yield_curve_dgs10 (rank #4 at 6.5%), yield_curve_dgs2, and yield_curve_yield_spread (rank #6 at 5.8%), which tell the meta-model WHERE yields and the spread currently sit. But they do NOT convey: (a) whether the curve is in a steepening or flattening REGIME (which drives different gold responses), (b) how fast the term structure is changing relative to its recent history (velocity/momentum of curve shifts), (c) whether the current curve shape is unusual relative to historical norms (position within the distribution of shapes). The submodel must extract these dynamics while avoiding VIF issues with the three existing yield curve base features AND with real_rate_real_rate (DFII10, correlated with DGS10).",

  "requirements": "Build a submodel that captures three orthogonal dimensions of yield curve dynamics: (1) YIELD CURVE REGIME -- Is the curve in a steepening, flattening, or inverting regime? Use an HMM or regime-switching model on the daily CHANGES in the 10Y-2Y spread (not the level, which is already a base feature). The regime provides context that distinguishes 'spread = 50bps and widening' from 'spread = 50bps and narrowing'. (2) SPREAD MOMENTUM / VELOCITY -- How fast is the yield curve shape changing? A z-score of the rate of change of the spread (e.g., 5d or 10d change, z-scored against a rolling window) captures whether current curve dynamics are rapid or gradual. Gold reacts differently to sudden flattening (flight to safety) vs gradual flattening (slow tightening). (3) CURVE POSITION INDICATOR -- Where is the current spread relative to its recent distribution? This could be a percentile rank or a z-score-based extreme indicator that signals when the curve is at unusual levels. However, this MUST be carefully designed to avoid high VIF with the raw yield_spread base feature. Using the spread level z-score directly would likely correlate with the spread level; instead, use a transformed version such as the acceleration (second derivative) of the spread, or a curvature measure involving additional maturity points. Output exactly 3 daily features.",

  "theoretical_background": {
    "why_yield_curve_matters_for_gold": "The yield curve encodes market expectations about future monetary policy, economic growth, and inflation. Gold's price is inversely related to the OPPORTUNITY COST of holding gold, which is captured by real yields. But beyond levels, the SHAPE and DYNAMICS of the yield curve carry additional information: (a) A steepening curve (long rates rising faster than short) signals growth expectations and potential inflation -- historically bullish for gold. (b) A flattening curve signals tightening expectations -- bearish for gold as the Fed raises short rates. (c) An inverting curve signals recession expectations -- bullish for gold as a safe haven. (d) The SPEED of curve changes matters: a sudden flattening signals panic/flight-to-quality (very bullish for gold), while a gradual flattening signals orderly tightening (moderately bearish). These dynamics are not captured by the raw spread level.",
    "what_base_features_provide": "Three columns: yield_curve_dgs10 (10Y Treasury yield, rank #4 at 6.5% importance), yield_curve_dgs2 (2Y Treasury yield), yield_curve_yield_spread (10Y - 2Y spread, rank #6 at 5.8% importance). These are raw daily levels. The meta-model can compute simple differences from consecutive days but cannot easily detect: (a) which yield curve regime the economy is in, (b) whether the current rate of change is historically fast or slow, (c) whether the current configuration is at an extreme that predicts reversal.",
    "what_submodel_adds": "Three dimensions of yield curve context that the raw levels cannot convey: (1) REGIME STATE -- classifies the current curve dynamics into distinct states (steepening/flattening/inversion transition), providing the meta-model with a discrete context variable. (2) CHANGE VELOCITY -- normalizes the speed of curve shifts against recent history, distinguishing panic moves from orderly shifts. (3) A third dimension capturing either curvature, volatility of the spread, or divergence between the spread dynamics and yield level dynamics.",
    "vif_critical_concern": "This is the HIGHEST VIF-RISK submodel in the pipeline. Three yield curve columns already exist in base features. Additionally, real_rate_real_rate (DFII10) is correlated with DGS10. The submodel MUST extract dynamics, regimes, and derived quantities -- NOT levels or simple derivatives. Key design principle: operate on CHANGES and HIGHER-ORDER DERIVATIVES of the spread, not the spread itself. The HMM should be fitted on spread changes (returns), not spread levels. Z-scores should be of change velocity, not of the spread level.",
    "relationship_to_real_rate": "The real_rate submodel failed after 5 attempts due to monthly frequency. Its core insight was that real interest rate dynamics (regime, persistence) carry information for gold. The yield_curve submodel captures a DIFFERENT dimension: not the real rate level (which DFII10 already provides) but the NOMINAL term structure dynamics. The 10Y-2Y spread captures the slope of the nominal curve, which encodes growth and policy expectations beyond what real rates convey. Key difference: (a) Real rate = inflation-adjusted cost of holding gold (level matters). (b) Yield curve = growth/policy expectations (dynamics and regime matter). These are complementary, not redundant.",
    "historical_yield_curve_gold_patterns": {
      "inversion_2019": "Yield curve inverted in August 2019 (10Y-2Y briefly negative). Gold rallied from $1400 to $1550 in the subsequent weeks as recession fears rose. The TRANSITION to inversion was the signal, not the level.",
      "steepening_2020_2021": "Post-COVID curve steepened dramatically (2Y anchored near 0, 10Y rose). Gold initially benefited from monetary easing but then declined as the steepening signaled recovery expectations.",
      "flattening_2022": "Aggressive Fed tightening flattened then inverted the curve. Gold was volatile but ultimately held value as inversion signaled recession risk.",
      "key_insight": "The REGIME TRANSITION is more informative than the current state. Markets price in the current state; submodel value comes from identifying the dynamics that precede gold moves."
    }
  },

  "data_strategy": {
    "primary_data": {
      "source": "FRED",
      "tickers": ["DGS10", "DGS2"],
      "frequency": "daily",
      "note": "10Y and 2Y Treasury yields. Already used as base features. Daily data, no interpolation needed. Data in data/raw/ already available."
    },
    "additional_maturity_candidates": [
      {
        "source": "FRED",
        "ticker": "DGS30",
        "description": "30Y Treasury yield. Enables butterfly/curvature computation: curvature = 2*DGS10 - DGS2 - DGS30. Adds a dimension beyond the simple slope.",
        "purpose": "Curvature captures convexity of the yield curve, which signals different macro regimes than slope alone.",
        "note": "Researcher should verify availability and alignment with DGS10/DGS2 date range."
      },
      {
        "source": "FRED",
        "ticker": "DGS5",
        "description": "5Y Treasury yield. Mid-point of curve, useful for belly curvature.",
        "purpose": "Alternative curvature measure: DGS5 - (DGS2 + DGS10)/2.",
        "note": "Researcher should evaluate whether 5Y adds information beyond 2Y-10Y."
      },
      {
        "source": "FRED",
        "ticker": "DFF",
        "description": "Federal Funds effective rate. Front-end of curve.",
        "purpose": "DGS2 - DFF spread captures near-term policy expectations.",
        "note": "Less likely needed if 2Y-10Y dynamics are sufficient."
      }
    ],
    "expected_samples": "~2523 daily observations (matching base_features date range 2015-01-30 to 2025-02-12)",
    "frequency_advantage": "FRED Treasury yields are daily. No interpolation needed. This is the key advantage over real_rate (monthly TIPS data)."
  },

  "research_questions": [
    "What is the most effective method for detecting YIELD CURVE REGIME shifts from daily data? Candidates: (a) HMM on daily changes in the 10Y-2Y spread (1D input, simpler, follows VIX pattern), (b) HMM on a 2D vector of [DGS10 change, DGS2 change] (captures parallel vs twist moves), (c) Markov Regime-Switching model on the spread change with switching means and variances, (d) threshold-based regime detection using spread level crossings (e.g., spread < 0 = inversion regime). Which captures the most informative regime probability for gold prediction? The VIX/technical/cross_asset submodels all succeeded with HMM -- what dimensionality of input works best for yield curve dynamics?",
    "What ADDITIONAL MATURITY POINTS beyond DGS10 and DGS2 are available daily from FRED and would add significant information? Specifically: (a) Is DGS30 available daily with sufficient history back to 2015? (b) Is DGS5 available? (c) Would a butterfly spread (2*DGS10 - DGS2 - DGS30) or belly curvature (DGS5 - avg(DGS2, DGS10)) provide a genuinely different signal from the 10Y-2Y slope? (d) Does the curvature measure correlate with the spread level (VIF risk)? The goal is to find a third feature dimension that is ORTHOGONAL to both the spread level and spread changes.",
    "What LOOKBACK WINDOWS are optimal for yield curve features? Specifically: (a) What window for spread change z-score captures meaningful velocity signals (5d change z-scored over 20d? 10d change over 60d?)? (b) How does the autocorrelation of spread change z-scores vary with window choice? We need autocorrelation < 0.99 to pass Gate 1. The VIX submodel used 60d z-score window successfully (autocorr 0.85-0.95). Does the yield curve behave similarly or does its persistence create higher autocorrelation? (c) What window for regime detection (HMM training) captures business cycle dynamics?",
    "What is the empirical VIF between YIELD CURVE DYNAMICS features and the existing base features (yield_curve_dgs10, yield_curve_dgs2, yield_curve_yield_spread) and real_rate_real_rate? Specifically: (a) Does a z-score of the 5d spread change correlate with the spread level? Theory says no (change vs level), but empirical verification is needed. (b) Does an HMM regime probability on spread changes correlate with the spread level? (c) Does a curvature measure (using DGS30 or DGS5) correlate with the existing spread? (d) What is the correlation between DGS10 and DFII10 (real rate)? If very high, yield curve features must be especially careful to capture DYNAMICS, not proxies for the real rate level.",
    "How does the yield curve's mean-reversion behavior differ from VIX? VIX has well-documented mean-reversion to ~18-20 with right-skewed spikes. Does the yield spread mean-revert similarly? (a) What is the historical mean of the 10Y-2Y spread? (b) What is the typical half-life of spread deviations? (c) Are there structural breaks in the mean (e.g., pre-GFC vs post-GFC vs post-COVID)? This matters for z-score window design: if the spread mean shifts structurally, a fixed long window z-score would be misleading.",
    "What is the academic evidence for yield curve DYNAMICS (not levels) predicting gold returns? Specifically: (a) Does the RATE OF CHANGE of the spread predict next-day gold returns better than the spread level? (b) Is there evidence that curve regime transitions (flattening to inversion, steepening to flattening) predict gold returns? (c) Does curve convexity/curvature carry predictive power for gold beyond the simple slope? Key papers to investigate: Estrella & Mishkin (1998) on yield curve as recession predictor, Campbell & Thompson (2008) on predictive regressions with Treasury yields.",
    "Should the yield curve submodel incorporate MULTI-COUNTRY yield curve data to increase information content? Specifically: (a) Are German (Bund), UK, Japanese yield curves available daily from FRED or other free sources? (b) Would a 'global yield curve slope' composite add information beyond the US curve alone? (c) Multi-country data was attempted for real_rate but failed due to monthly frequency. If daily yield data is available for other countries, it could be valuable. (d) What is the risk of VIF between a global curve slope and the US curve slope?"
  ],

  "candidate_approaches": {
    "approach_A_hmm_spread_regime": {
      "description": "HMM on daily changes in the 10Y-2Y spread to detect steepening/flattening/inversion regimes, plus spread change velocity z-score, plus curvature measure (DGS30 or DGS5-based). Follows the proven HMM + deterministic pattern.",
      "output": ["yc_regime_prob", "yc_spread_velocity_z", "yc_curvature_z"],
      "pros": "Follows proven HMM pattern. Spread changes are orthogonal to spread level (VIF safe). Curvature adds new dimension beyond 2Y-10Y slope.",
      "cons": "1D HMM on spread changes may produce noisy regime detection (spread changes are small daily). Curvature requires additional maturity data from FRED (DGS30 or DGS5)."
    },
    "approach_B_2d_hmm_twist": {
      "description": "HMM on 2D vector [DGS10 change, DGS2 change] to detect parallel shift vs twist vs pivoting regimes. Plus spread change velocity z-score. Plus spread volatility regime (rolling std of spread changes).",
      "output": ["yc_twist_regime_prob", "yc_spread_velocity_z", "yc_spread_vol_z"],
      "pros": "2D HMM captures richer dynamics (parallel vs twist). Same approach that improved technical submodel (2D HMM on [returns, GK_vol]). No additional maturity data needed.",
      "cons": "2D input [DGS10_chg, DGS2_chg] may correlate highly (both are Treasury yields). Need to verify the two dimensions provide distinct information. Spread volatility z-score may correlate with VIX."
    },
    "approach_C_deterministic_only": {
      "description": "Entirely deterministic: spread change z-score (velocity), spread acceleration (second derivative of spread), and spread/vol ratio (spread change normalized by yield volatility). No HMM.",
      "output": ["yc_spread_velocity_z", "yc_spread_acceleration", "yc_yield_vol_ratio"],
      "pros": "No overfitting risk (fully deterministic). Simple and fast. Each feature is a different derivative order of the spread.",
      "cons": "No regime detection component. Previous successes all used HMM for regime. Acceleration (second derivative) may be very noisy on daily data."
    },
    "approach_D_multi_country": {
      "description": "HMM on US spread changes, plus US-Germany spread differential (term structure arbitrage signal), plus global yield curve slope composite.",
      "output": ["yc_regime_prob", "yc_us_de_differential_z", "yc_global_slope_z"],
      "pros": "Multi-country adds information beyond US-only curve. US-Germany differential captures monetary policy divergence. Global composite smooths country-specific noise.",
      "cons": "German/UK daily yield data availability from FRED is uncertain. If only monthly data is available, it reproduces the real_rate frequency problem. Researcher must verify daily availability."
    }
  },

  "constraints": [
    "All data must be daily frequency -- FRED Treasury yields (DGS10, DGS2) are daily, within 1-day delay. Any additional maturity points must also be daily. If multi-country yield data is only monthly, DO NOT USE IT (real_rate lesson)",
    "Submodel does NOT predict gold prices -- it extracts yield curve dynamics (regime, velocity, curvature) that provide context for how the term structure environment affects gold",
    "Output must be exactly 3 columns (lessons from VIX/technical/cross_asset success with 3 compact features)",
    "CRITICAL VIF CONSTRAINT: Output must have VIF < 10 against ALL existing base features, especially: yield_curve_dgs10, yield_curve_dgs2, yield_curve_yield_spread, AND real_rate_real_rate. This is the hardest VIF challenge of any submodel because 3 yield curve columns plus 1 real rate column are already in base features. Features MUST operate on changes, regimes, or higher-order derivatives -- NOT levels",
    "Output must have VIF < 10 against existing submodel outputs: vix_regime_probability, vix_mean_reversion_z, vix_persistence, tech_trend_regime_prob, tech_mean_reversion_z, tech_volatility_regime, xasset_regime_prob, xasset_recession_signal, xasset_divergence. Particular risk: yield curve regime may correlate with VIX regime (both capture macro regime shifts)",
    "Autocorrelation < 0.99 for all output columns. Yield spread levels have very high persistence (near unit root). Features MUST use changes, z-scores of changes, or regime probabilities -- NOT raw spread levels or z-scores of spread levels. The raw spread z-score will almost certainly fail Gate 1 autocorrelation",
    "Features must be computable at inference time without lookahead bias -- all rolling windows backward-looking, HMM fit on training set only",
    "Avoid features that duplicate information already captured by the raw yield_spread base feature. A z-score of the spread level would correlate highly with the spread level itself and add minimal new information. Focus on DYNAMICS (how the spread is MOVING) not POSITION (where the spread IS)",
    "If using curvature (DGS30 or DGS5), verify daily data availability from FRED covering the full 2015-2025 period before committing to that design"
  ],

  "output_schema": {
    "target_columns": 3,
    "candidate_columns": [
      "yc_regime_prob: Probability of being in a specific yield curve dynamics regime (e.g., rapid flattening = 'tightening fear' regime). From HMM on spread changes or [DGS10_chg, DGS2_chg]. Captures the latent state of curve dynamics. Range [0, 1].",
      "yc_spread_velocity_z: Z-score of the N-day change in the yield spread, normalized against a rolling window. Captures how FAST the curve is moving relative to recent history. Positive = rapid steepening, negative = rapid flattening. Range [-4, +4].",
      "yc_curvature_z OR yc_spread_vol_z: Either (a) a curvature/butterfly measure using DGS30/DGS5 (if available daily), z-scored and differenced, or (b) rolling volatility of spread changes z-scored (how turbulent are current curve dynamics). Either provides a third dimension orthogonal to regime and velocity."
    ],
    "properties": [
      "All daily frequency, no interpolation",
      "No NaN values after warmup period (max ~90 days for longest rolling window)",
      "VIF < 10 against yield_curve_dgs10, yield_curve_dgs2, yield_curve_yield_spread, AND real_rate_real_rate",
      "VIF < 10 against all existing submodel outputs",
      "Each feature captures a DIFFERENT dimension: regime (which state), velocity (how fast), curvature/volatility (what shape/turbulence)",
      "Features encode DYNAMICS that raw yield levels cannot convey"
    ]
  },

  "success_hypothesis": "Yield curve dynamics (steepening/flattening regime, change velocity, curvature or volatility) will provide the meta-model with term structure context that improves direction accuracy by +0.5% or more. The key insight is that identical spread levels have very different gold implications depending on the dynamics: a spread of +50bps that is rapidly narrowing (curve flattening = tightening expectations = bearish gold) is fundamentally different from a spread of +50bps that is widening (curve steepening = easing expectations = bullish gold). Base features already include the spread level (rank #6 at 5.8%), and adding dynamic context should amplify its predictive value. The proven HMM + deterministic pattern (successful in VIX, technical, cross_asset) provides the template.",

  "success_criteria": {
    "gate1": {
      "overfit_ratio": "< 1.5 (if neural network used; N/A if deterministic methods like HMM/rolling stats)",
      "no_constant_output": true,
      "autocorrelation": "< 0.99 for all output columns. This is the key risk: yield curve persistence is high. Features MUST operate on changes not levels."
    },
    "gate2": {
      "mi_increase": "> 5% (sum-based, total MI of all features including submodel outputs vs without)",
      "vif": "< 10 for all submodel output columns. This is the HARDEST VIF test of any submodel -- 4 correlated base features (3 yield curve + 1 real rate) already present.",
      "rolling_correlation_std": "< 0.15"
    },
    "gate3": {
      "direction_accuracy_delta": "> +0.5%",
      "or_sharpe_delta": "> +0.05",
      "or_mae_delta": "< -0.01%",
      "note": "Any ONE of these three is sufficient to pass Gate 3"
    }
  },

  "lessons_from_previous_features": {
    "real_rate_failure": {
      "root_cause": "Monthly-to-daily frequency mismatch. 5 attempts, all passed Gate 2 (MI up to +39.3%) but failed Gate 3. Forward-fill/interpolation of monthly data to daily created artifacts.",
      "lesson_applied": "Yield curve data (DGS10, DGS2) is daily from FRED. No interpolation needed. This eliminates the root cause of real_rate failure."
    },
    "real_rate_vif_relevance": {
      "observation": "real_rate (DFII10 = 10Y TIPS yield) is highly correlated with DGS10 (10Y nominal yield). DFII10 ~ DGS10 - T10YIE (breakeven inflation). The yield_curve submodel MUST NOT produce features that proxy for nominal yield levels, as this would create VIF issues with both DGS10 and DFII10.",
      "lesson_applied": "Operate on spread CHANGES and DYNAMICS only. Never on yield levels or spread levels."
    },
    "compact_3_feature_pattern": {
      "observation": "All 4 successful submodels (dxy, vix, technical, cross_asset) used exactly 3 output columns. real_rate attempt 5 used 7 columns and failed hardest. More columns = more noise surface for XGBoost to overfit.",
      "lesson_applied": "Exactly 3 output columns."
    },
    "hmm_regime_pattern": {
      "observation": "HMM regime detection is the backbone of all successful submodels. VIX: regime on log-VIX changes (1D). Technical: regime on [returns, GK_vol] (2D). Cross_asset: regime on [gold_ret, silver_ret, copper_ret] (3D). All produced informative regime probabilities.",
      "lesson_applied": "Use HMM on yield curve CHANGES (spread change or [DGS10_chg, DGS2_chg]). The dimensionality choice (1D vs 2D) should be investigated by the researcher."
    },
    "autocorrelation_design": {
      "observation": "Raw z-scores of smooth series have dangerously high autocorrelation (cross_asset gold/copper ratio z-score: 0.959). The solution is to use first differences of z-scores or z-scores of short-period changes.",
      "lesson_applied": "NEVER use raw spread z-score as output. Use z-score of spread CHANGES, first differences, or other transformations that reduce autocorrelation below 0.99."
    },
    "vix_cross_asset_gate2_stability": {
      "observation": "VIX, technical, and cross_asset all had Gate 2 stability marginally fail for regime_prob only (0.15-0.21 vs 0.15 threshold). This appears to be an inherent property of regime features and has been accepted as precedent.",
      "lesson_applied": "Expect yc_regime_prob stability to be marginal. This is acceptable given precedent."
    }
  },

  "vif_risk_analysis": {
    "critical_concern": "This is the HIGHEST VIF-RISK submodel. The base features contain 3 yield curve columns (DGS10, DGS2, yield_spread) plus real_rate (DFII10, which is DGS10 - breakeven inflation). Any feature that correlates with yield LEVELS will fail VIF.",
    "base_feature_correlations": {
      "yield_curve_dgs10_vs_real_rate": "Expected very high correlation (0.7-0.9). DGS10 = DFII10 + breakeven. Both move together.",
      "yield_curve_dgs10_vs_yield_spread": "Moderate correlation. When DGS10 rises without DGS2 matching, spread widens.",
      "yield_curve_dgs2_vs_yield_spread": "Negative moderate correlation. DGS2 rise narrows spread.",
      "hmm_regime_on_spread_changes_vs_spread_level": "Expected LOW correlation. Regime of changes is about HOW the spread is moving, not WHERE it is. Similar to VIX regime vs VIX level (measured 0.2-0.4).",
      "spread_change_velocity_z_vs_spread_level": "Expected LOW correlation. Z-score of 5d change captures velocity, not position. Change and level are near-orthogonal for mean-reverting series.",
      "curvature_vs_spread": "Needs empirical verification. Curvature (2*DGS10 - DGS2 - DGS30) may correlate with the spread if DGS30 and DGS10 move together. Researcher must measure."
    },
    "submodel_output_correlations": {
      "yc_regime_prob_vs_vix_regime_probability": "MODERATE RISK. Both capture macro regime shifts. Yield curve flattening and VIX spikes can co-occur. But they capture different phenomena: curve dynamics vs equity vol. Expected correlation 0.2-0.4.",
      "yc_spread_velocity_z_vs_xasset_recession_signal": "MODERATE RISK. Both capture rate-of-change of macro indicators. Spread flattening velocity and gold/copper ratio change may move together during recessions. Expected correlation 0.2-0.3.",
      "yc_regime_prob_vs_tech_trend_regime_prob": "LOW RISK. Gold technicals and yield curve dynamics capture different markets."
    },
    "mitigation_strategy": "All features must operate on CHANGES and DERIVATIVES of the yield curve, never on levels. The HMM should be trained on spread changes or yield changes. Z-scores should be of multi-day changes, not levels. Curvature should use daily changes of the butterfly spread. This structural design ensures orthogonality with level-based base features."
  },

  "previous_feedback": null,

  "created_at": "2026-02-15T12:00:00"
}
