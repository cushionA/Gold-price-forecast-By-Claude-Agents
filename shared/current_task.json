{
  "feature": "real_rate",
  "attempt": 3,
  "phase": "smoke_test",
  "source": "user_decision",
  "approach": "multi_country_transformer",
  "data_source": "Multi-country real interest rates: US (FRED DFII10) + 7 countries synthetic (Nominal 10Y - CPI)",
  "objective": "Extract economic semantic meaning from global real interest rate patterns. Learn policy coordination, market stress regimes, and inflation dynamics by observing how rates move across 8 countries simultaneously. Enrich US real rate with contextual understanding of 'why' rates moved, not just 'how much'.",

  "requirements": "Build a Transformer-based submodel that processes multi-country real rate time series and learns latent semantic features representing: (1) Policy coordination level (central banks moving together vs diverging), (2) Market stress regime (crisis vs normal), (3) Inflation regime (demand-driven vs supply shock), (4) Global vs local shock factor. These semantic features provide economic context that single-country time-series models cannot capture.",

  "theoretical_background": {
    "core_hypothesis": "Gold doesn't react to US rates in isolation -- it reacts to GLOBAL monetary policy regimes. The same +0.5% US rate increase has different implications when: (a) all countries are tightening together (coordinated normalization), vs (b) US is tightening alone while others ease (divergence = stress).",
    "why_multi_country": "By observing cross-country rate movements, we can infer the underlying economic regime. High cross-country correlation = global shock (Fed dominates). Low correlation = local shocks (regional crises). Rates falling globally + VIX rising = flight-to-quality. This context is invisible to US-only models.",
    "what_baseline_misses": "Baseline sees only US DFII10 level. It cannot distinguish between: (a) US rate rises 0.5% during global coordinated tightening (low gold impact), vs (b) US rate rises 0.5% while others diverge (high gold volatility). Multi-country context reveals this difference."
  },

  "previous_feedback": {
    "attempt_1": {
      "architecture": "MLP Autoencoder (US-only)",
      "gate1": false,
      "gate2": true,
      "gate3": false,
      "failures": ["overfit_ratio=2.69", "autocorr>0.99", "identity_mapping", "gate3_no_improvement"],
      "successes": ["MI_increase=18.5%", "VIF<10", "correlation_stable"],
      "diagnosis": "Single-country MLP overfits and learns identity mapping. Information exists but extraction quality too low."
    },
    "attempt_2": {
      "architecture": "GRU Autoencoder (US-only)",
      "gate1": null,
      "gate2": null,
      "gate3": null,
      "failures": ["optuna_all_trials_pruned", "no_completed_trials", "gru_convergence_failure"],
      "diagnosis": "GRU failed to converge across all 20 Optuna trials. MedianPruner pruned every trial. Single-country approach hitting fundamental limits."
    },
    "pattern": "Two consecutive failures with US-only data suggest the problem is not just architecture, but insufficient information content in single-country time series. Multi-country approach addresses root cause."
  },

  "multi_country_strategy": {
    "data_availability": {
      "countries": 8,
      "list": ["US", "Germany", "UK", "Canada", "Switzerland", "Norway", "Sweden", "Japan (excluded due to outdated CPI)"],
      "us_data": "Direct TIPS (FRED DFII10), daily, 2003-2026",
      "other_countries": "Synthetic (Nominal 10Y - CPI year-over-year, lagged 1 month), monthly, 2003-2025",
      "common_period": "2003-01 to 2025-11 (274 months, ~23 years)",
      "sample_size": "2,192 stacked (8 countries Ã— 274 months) OR 5,957 hybrid (US daily + monthly context)"
    },
    "synthetic_real_rate_formula": "Real Rate = Nominal 10Y Yield - CPI YoY (lagged 1 month to avoid look-ahead bias)",
    "expected_accuracy": "Correlation >0.85 vs true real rates, RMSE ~0.5-1.0%",
    "research_report": "docs/research/multi_country_real_rates.md",
    "feasibility": "85% confidence (confirmed by researcher agent)"
  },

  "architect_requirements": {
    "architecture": "Temporal Transformer Encoder",
    "input_format": "[batch, seq_len, n_countries * features_per_country + context_features]",
    "countries": 8,
    "features_per_country": ["real_rate_change", "real_rate_level", "policy_rate_change"],
    "context_features": ["VIX", "oil_price_change", "credit_spread"],
    "attention_mechanism": "Multi-head self-attention to learn cross-country relationships",
    "output": "4-8 latent dimensions representing economic semantic features",
    "latent_semantics": {
      "policy_coordination": "Cross-country variance of rate changes (low = coordinated, high = divergent)",
      "market_stress": "Interaction between rate movements and VIX",
      "inflation_regime": "Persistent rate level across countries",
      "shock_type": "Cross-country correlation (high = global, low = local)"
    },
    "expected_improvements": {
      "vs_attempt_1": "+1.0-1.5% direction accuracy, +0.10-0.15 Sharpe",
      "gate1": "Expect overfit_ratio <1.3 due to 2,192+ samples",
      "gate2": "Expect MI increase >20% due to richer feature space",
      "gate3": "High probability of passing due to semantic meaning extraction"
    }
  },

  "fact_check_requirements": [
    "Verify US synthetic vs DFII10 correlation >0.85 (acceptable approximation)",
    "Confirm 2,192 samples sufficient for Transformer (or recommend hybrid 5,957 approach)",
    "Validate CPI lag (1 month) prevents future leakage",
    "Check Transformer memory requirements fit in Kaggle (estimate: ~500MB with 4-layer, hidden_dim=64)",
    "Verify all FRED series IDs are accessible and current"
  ],

  "optuna_search_space": {
    "num_layers": [2, 4, 6],
    "hidden_dim": [32, 64, 128],
    "num_heads": [2, 4, 8],
    "latent_dim": [4, 6, 8],
    "dropout": [0.2, 0.4],
    "learning_rate": [1e-5, 1e-3],
    "weight_decay": [1e-5, 1e-3],
    "window_size": [12, 24, 36],
    "batch_size": [16, 32, 64]
  },

  "constraints": [
    "All data sources must use FRED API only (no additional auth required)",
    "CPI must be lagged 1 month to avoid publication lag leakage",
    "Synthetic real rates validated against US DFII10 (correlation check)",
    "Time-series split: train 70% / val 15% / test 15%",
    "Overfit ratio < 1.5",
    "Output VIF < 10 when combined with base features",
    "Kaggle execution time < 4 hours (within 9-hour limit)",
    "No future information leakage",
    "Submodel does NOT predict gold prices directly"
  ],

  "kaggle_settings": {
    "enable_gpu": false,
    "enable_internet": true,
    "estimated_time_hours": 2.5,
    "estimated_memory_gb": 2,
    "optuna_trials": 30
  },

  "submodel_output_spec": {
    "type": "continuous semantic features",
    "dimensions": "4-8 (determined by Optuna)",
    "column_names": ["real_rate_sem_0", "real_rate_sem_1", "real_rate_sem_2", "real_rate_sem_3", "..."],
    "semantic_meaning": "Each dimension represents an interpretable economic concept (policy coordination, stress, inflation regime, shock type)",
    "alignment": "Monthly or daily (depending on hybrid vs stacked approach)",
    "postprocessing": "Optional: first-difference if autocorr still high"
  },

  "success_criteria": {
    "gate1": "overfit_ratio < 1.5, autocorr < 0.95",
    "gate2": "MI increase > 10%, VIF < 10",
    "gate3": "Direction accuracy +0.5%, Sharpe +0.05, or MAE -0.01%"
  },

  "fallback_plan": {
    "if_gate1_fails": "Reduce model complexity: 2-layer Transformer, hidden_dim=32",
    "if_gate2_fails": "Check feature engineering: may need additional context features",
    "if_gate3_fails": "Consider supervised approach: predict gold returns directly with multi-country inputs",
    "if_all_fail": "Return to single-country with classical methods (HMM, Markov-switching)"
  },

  "created_at": "2026-02-14",
  "smoke_test_note": "This is still part of Phase 1.5 smoke test, but with fundamental architecture change based on 2 consecutive single-country failures."
}
