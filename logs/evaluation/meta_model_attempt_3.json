{
  "feature": "meta_model",
  "attempt": 3,
  "timestamp": "2026-02-15T21:30:00",
  "architecture": "5-model XGBoost ensemble with confidence-based re-ranking",
  "phase": "3_meta_model",
  "evaluation_type": "final_targets",
  "data_note": "CRITICAL: predictions.csv contained stale Attempt 2 data. Evaluation uses test_predictions.csv which contains the actual Attempt 3 ensemble output.",
  "metrics": {
    "test": {
      "direction_accuracy": 0.5330,
      "high_confidence_da": 0.5921,
      "mae": 0.7173,
      "sharpe_ratio": 1.2201,
      "sharpe_formula": "CLAUDE.md position-change cost only (5bps)"
    },
    "train": {
      "direction_accuracy": 0.7926,
      "high_confidence_da": 0.9688,
      "mae": 0.4274,
      "sharpe_ratio": 11.0365
    },
    "val": {
      "direction_accuracy": 0.5809,
      "high_confidence_da": 0.5333,
      "mae": 0.7459,
      "sharpe_ratio": 3.2250
    }
  },
  "target_evaluation": {
    "direction_accuracy": {
      "target": "> 56.0%",
      "actual": "53.30%",
      "gap": "-2.70pp",
      "passed": false
    },
    "high_confidence_da": {
      "target": "> 60.0%",
      "actual": "59.21%",
      "gap": "-0.79pp",
      "passed": false
    },
    "mae": {
      "target": "< 0.75%",
      "actual": "0.7173%",
      "gap": "-0.0327%",
      "passed": true
    },
    "sharpe_ratio": {
      "target": "> 0.80",
      "actual": "1.2201",
      "gap": "+0.4201",
      "passed": true
    }
  },
  "targets_passed": 2,
  "targets_total": 4,
  "overfitting_analysis": {
    "train_test_da_gap_pp": 25.96,
    "train_val_da_gap_pp": 21.17,
    "train_test_hcda_gap_pp": 37.67,
    "target_gap_pp": 10.0,
    "overfitting_check": "FAIL - SEVERE",
    "attempt2_gap_pp": 5.54,
    "gap_worsened_by_pp": 20.42,
    "overfit_ratio_da": 1.4871,
    "train_correlation": 0.8472,
    "test_correlation": 0.0667
  },
  "vs_attempt_2": {
    "da_delta_pp": -3.96,
    "hcda_delta_pp": 3.95,
    "mae_delta": 0.0296,
    "sharpe_delta": -0.3634,
    "train_da_gap_delta_pp": 20.42,
    "da_direction": "WORSE",
    "hcda_direction": "BETTER",
    "mae_direction": "WORSE",
    "sharpe_direction": "WORSE",
    "overfit_direction": "MUCH_WORSE"
  },
  "vs_naive": {
    "naive_always_up_da": "56.73%",
    "model_vs_naive_pp": -3.43,
    "note": "Model is WORSE than naive always-up strategy on DA"
  },
  "prediction_characteristics": {
    "pred_actual_std_ratio": 0.4090,
    "pred_actual_correlation": 0.0667,
    "positive_pred_pct": 54.9,
    "positive_actual_pct": 56.7,
    "n_position_changes": 133,
    "pred_range": [-2.0278, 1.0567],
    "actual_range": [-3.4355, 3.1081]
  },
  "hcda_analysis": {
    "top_30pct_da": 0.5965,
    "top_25pct_da": 0.5895,
    "top_20pct_da": 0.5921,
    "top_15pct_da": 0.5965,
    "top_10pct_da": 0.6053,
    "top_5pct_da": 0.5789,
    "high_conf_up_da": 0.6000,
    "high_conf_down_da": 0.5833,
    "note": "HCDA improved from 55.26% to 59.21% (+3.95pp) but at cost of DA regression. Re-ranking had zero effect (standard = reranked = 59.21%). Only top-10% (N=38) passes 60% target."
  },
  "reranking_analysis": {
    "hcda_standard": 0.5921,
    "hcda_reranked": 0.5921,
    "reranking_effect_pp": 0.0,
    "note": "Confidence-based re-ranking produced ZERO improvement. alpha_confidence=0.7975 was optimized but had no discriminating effect on test set."
  },
  "quarterly_performance": {
    "2023Q3": {"da": 65.7, "hcda": 28.6, "mae": 0.5373, "sharpe": 1.37, "n": 35},
    "2023Q4": {"da": 52.4, "hcda": 53.8, "mae": 0.6847, "sharpe": 0.02, "n": 63},
    "2024Q1": {"da": 44.3, "hcda": 66.7, "mae": 0.5819, "sharpe": -0.08, "n": 61},
    "2024Q2": {"da": 52.4, "hcda": 53.8, "mae": 0.9209, "sharpe": 2.45, "n": 63},
    "2024Q3": {"da": 53.1, "hcda": 69.2, "mae": 0.7304, "sharpe": 2.84, "n": 64},
    "2024Q4": {"da": 56.2, "hcda": 61.5, "mae": 0.7706, "sharpe": 1.08, "n": 64},
    "2025Q1": {"da": 55.2, "hcda": 50.0, "mae": 0.7007, "sharpe": -0.39, "n": 29}
  },
  "ensemble_analysis": {
    "n_models": 5,
    "seeds": [42, 137, 256, 389, 512],
    "alpha_confidence": 0.7975,
    "ensemble_effect": "NEGATIVE - Ensemble increased training complexity, worsened overfitting (train DA 79.26% vs Attempt 2's 62.79%), and degraded test DA while marginally improving HCDA",
    "best_params": {
      "n_estimators": 300,
      "max_depth": 3,
      "learning_rate": 0.097,
      "min_child_weight": 11,
      "subsample": 0.745,
      "colsample_bytree": 0.724,
      "reg_lambda": 7.576,
      "reg_alpha": 2.885,
      "gamma": 0.419
    }
  },
  "model_config": {
    "n_features": 22,
    "train_samples": 1765,
    "val_samples": 378,
    "test_samples": 379,
    "samples_per_feature_ratio": 80.2,
    "optuna_trials": 80,
    "optuna_objective_weights": "Sharpe 40%, DA 25%, HCDA 25%, MAE 10%"
  },
  "decision": "regression_from_attempt_2",
  "overall_passed": false,
  "failed_targets": ["direction_accuracy", "high_confidence_da"],
  "root_cause_analysis": {
    "primary": "5-model ensemble with n_estimators=300 and max_depth=3 created significantly more model capacity than Attempt 2 (n_estimators=247, max_depth=2). This resulted in severe overfitting: train DA jumped from 62.79% to 79.26%, while test DA dropped from 57.26% to 53.30%.",
    "secondary": "The ensemble averaging improved HCDA by making high-confidence predictions more reliable (+3.95pp to 59.21%), but at the cost of making low/medium-confidence predictions worse. Net effect: DA below naive always-up baseline.",
    "reranking_failure": "Confidence-based re-ranking was a no-op. alpha_confidence was optimized on validation set but produced identical standard and reranked HCDA, suggesting the re-ranking criteria was redundant with the ensemble's natural confidence ordering.",
    "key_insight": "The Attempt 2 model was already near-optimal. Attempt 3's added complexity (ensemble, re-ranking, higher max_depth) degraded generalization. The HCDA improvement came from prediction magnitude expansion (std ratio 0.41 vs 0.19) but this same expansion hurt DA by adding more wrong directional calls."
  }
}
