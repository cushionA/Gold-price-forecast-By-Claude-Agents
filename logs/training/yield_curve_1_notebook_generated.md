# Yield Curve Attempt 1 - Kaggle Notebook Generation Summary

**Generated by:** builder_model agent
**Timestamp:** 2026-02-15T10:00:00
**Status:** âœ… Ready for Kaggle submission

## Files Generated

### 1. kernel-metadata.json
- **Location:** `notebooks/yield_curve_1/kernel-metadata.json`
- **Kernel ID:** `tatuk77/gold-yield-curve-1`
- **GPU:** Disabled (HMM + deterministic features = CPU only)
- **Internet:** Enabled (for FRED API and Yahoo Finance)

### 2. train.py
- **Location:** `notebooks/yield_curve_1/train.py`
- **Size:** ~15 KB
- **Syntax Check:** âœ… PASS
- **Self-contained:** Yes (no external file dependencies)

## Implementation Highlights

### Data Fetching (Embedded from src/fetch_yield_curve.py)
- Fetches DGS10, DGS2, DGS5 from FRED API
- Fetches GLD from Yahoo Finance for target
- Start date: 2014-10-01 (warmup buffer for 60-day rolling windows)
- Inner join alignment to ensure no mismatched dates
- Forward-fill gaps up to 3 days

### Model Architecture (Following Design Doc)

#### Component 1: 2D HMM Regime Detection
- Input: [DGS10_change, DGS2_change] (2D daily yield changes)
- States: 2, 3, or 4 (Optuna selects)
- Covariance: 'full' or 'diag' (Optuna selects)
- Multi-restart: 5 seeds [0, 42, 123, 456, 789], select best log-likelihood
- Output: P(bearish-for-gold state) based on training set state-gold correlation

#### Component 2: Spread Velocity Z-Score
- Input: DGS10 - DGS2 spread
- Change window: 3, 5, or 10 days (Optuna selects)
- Z-score window: 30, 60, 90, or 120 days (Optuna selects)
- Computation: z-score of N-day spread change, clipped to [-4, +4]
- Forward-fill warmup NaN

#### Component 3: Curvature Z-Score
- Input: DGS5 - 0.5*(DGS2 + DGS10)
- Z-score window: 30, 60, 90, or 120 days (Optuna selects)
- Computation: z-score of daily curvature change, clipped to [-4, +4]
- Forward-fill warmup NaN

### Optuna HPO
- **Objective:** Maximize MI sum on validation set
- **Search space:**
  - `hmm_n_components`: {2, 3, 4}
  - `hmm_covariance_type`: {'full', 'diag'}
  - `velocity_change_window`: {3, 5, 10}
  - `velocity_zscore_window`: {30, 60, 90, 120}
  - `curvature_zscore_window`: {30, 60, 90, 120}
- **Trials:** 30
- **Timeout:** 600 seconds (10 minutes)
- **Sampler:** TPESampler(seed=42)
- **Total combinations:** 3 Ã— 2 Ã— 3 Ã— 4 Ã— 4 = 288

### Output Format
- **Columns:** 3
  - `yc_regime_prob` (0-1): Probability of bearish-for-gold yield curve regime
  - `yc_spread_velocity_z` (-4 to +4): Z-score of N-day spread change
  - `yc_curvature_z` (-4 to +4): Z-score of daily curvature change
- **Index:** Date (matching gold target dates)
- **File:** `submodel_output.csv`

### Metrics Logged
- **Mutual Information:** Individual MI for each feature + MI sum (validation set)
- **Autocorrelation:** Lag-1 autocorrelation for Gate 1 check (training set)
- **Optuna Results:** Best value, best params, completed trials
- **Data Splits:** Train/val/test sample counts

## Design Adherence

âœ… **Self-contained:** All data fetching embedded, no external files
âœ… **No lookahead bias:** HMM fits on train only, z-scores use backward-looking windows
âœ… **Reproducibility:** Fixed random seeds (42 for Optuna, multi-restart seeds for HMM)
âœ… **API key security:** Uses Kaggle Secrets (os.environ or UserSecretsClient)
âœ… **No hardcoded credentials:** Fails immediately with KeyError if FRED_API_KEY missing
âœ… **Forward-fill warmup NaN:** All features handle initial NaN from rolling windows
âœ… **Multi-restart HMM:** Manual loop over 5 seeds (hmmlearn has no n_init parameter)
âœ… **State labeling:** Selects most bearish state for gold based on training set correlation

## Expected Execution Time
- Data download: ~30 seconds
- Optuna 30 trials Ã— ~5 seconds each: ~2.5 minutes
- Final feature generation: ~30 seconds
- **Total:** 3-5 minutes

## Expected Results (Gate Predictions)

### Gate 1: Standalone Quality
- **Overfit ratio:** N/A (deterministic HMM, no gradient training)
- **Autocorrelation:** Expected safe (design: curvature_z = -0.15, velocity_z = 0.62-0.86)
- **No constant output:** Yes (regime prob varies, z-scores vary with yield dynamics)
- **Prediction:** âœ… PASS

### Gate 2: Information Gain
- **MI increase:** Expected >5% (design: curvature MI = 0.076, velocity MI = 0.074)
- **VIF:** Expected <10 (measured 1.01 in design validation)
- **Stability:** Regime_prob likely marginal ~0.15-0.21 (accepted precedent from VIX/technical/cross_asset)
- **Prediction:** âœ… PASS (or marginal on stability, accepted precedent)

### Gate 3: Ablation
- **Direction accuracy:** Moderate probability (+0.5% threshold)
- **Sharpe:** Moderate probability (+0.05 threshold)
- **MAE:** Higher probability (-0.01% threshold, technical achieved -0.18, cross_asset achieved -0.087)
- **Prediction:** ðŸŸ¡ Moderate-high confidence (70%)

## Next Steps for Orchestrator

1. **Submit to Kaggle:**
   ```bash
   kaggle kernels push -p notebooks/yield_curve_1/
   ```

2. **Monitor status:**
   ```bash
   kaggle kernels status tatuk77/gold-yield-curve-1
   ```

3. **Fetch results when complete:**
   ```bash
   kaggle kernels output tatuk77/gold-yield-curve-1 \
     -p data/submodel_outputs/yield_curve/
   ```

4. **Place files:**
   - `submodel_output.csv` â†’ `data/submodel_outputs/yield_curve.csv`
   - `training_result.json` â†’ `logs/training/yield_curve_1.json`

5. **Pass to evaluator** for Gate 1/2/3 evaluation

## Risk Assessment

### Low Risk
- Daily frequency eliminates interpolation artifacts (real_rate failure root cause)
- All features based on changes/derivatives (not levels with unit root)
- Compact 3-feature design (not 7 like real_rate attempt 5)
- Measured VIF = 1.01 (excellent)
- All autocorrelations < 0.99

### Moderate Risk
- 2D HMM may produce poor regime separation (DGS10-DGS2 corr = 0.761)
  - Mitigation: Optuna explores 2-4 states, precedent from technical (93%/7%/0.4% occupancy succeeded)
- Curvature feature may add noise (autocorr = -0.15)
  - Mitigation: XGBoost can assign low importance, MI = 0.076 comparable to VIX regime

### Fallbacks (for Attempt 2 if needed)
1. **If 2D HMM fails:** Switch to 1D HMM on spread_change
2. **If velocity autocorr too high:** Use first difference of velocity_z
3. **If curvature adds noise:** Replace with spread volatility z-score
4. **If Gate 3 fails:** Fully deterministic approach (no HMM)

## Confidence Level
**Overall:** 70% (moderate-high)
- Strong fundamentals (daily frequency, low VIF, proven pattern)
- Moderate uncertainty on HMM regime separation quality
- Design validates MI comparable to successful submodels
