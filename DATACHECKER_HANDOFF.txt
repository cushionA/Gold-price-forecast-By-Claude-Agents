================================================================================
                        DATACHECKER HANDOFF
================================================================================

FROM:     Datachecker Agent (Haiku)
TO:       Builder Model Agent (Sonnet)
DATE:     2026-02-15T23:32:49
STATUS:   PASS - Ready for Kaggle notebook generation

================================================================================
                        FEATURE SUMMARY
================================================================================

Feature:          options_market
Attempt:          1
Data Status:      PASS (all 7 validation steps)

Data Location:    data/processed/options_market_features.csv
Data Shape:       2,802 rows × 4 columns
Date Range:       2014-10-01 to 2026-02-12
Target Alignment: 2,484 / 2,542 rows (97.72%)

================================================================================
                        DATA COLUMNS
================================================================================

Column Name       | Type    | Range          | Status
----------------- | ------- | -------------- | -------
skew_close        | float64 | 110.34-183.12  | ✓ Ready
gvz_close         | float64 | 8.88-48.98     | ✓ Ready
skew_change       | float64 | -22.81-24.75   | ✓ Ready
gvz_change        | float64 | -9.50-7.25     | ✓ Ready

All columns within design spec ranges.
All columns have meaningful variation (std > 1).
No constant columns detected.
Missing data: 0.07% (negligible).

================================================================================
                        CRITICAL FINDINGS
================================================================================

✓ No future information leakage (lag-0 correlations all < 0.03)
✓ No autocorrelation > 0.99 (max: 0.9742 for gvz_close)
✓ Both change series strongly stationary (ADF p < 0.0001)
✓ Date order correct, no duplicates, max gap 5 days
✓ Fetch script uses only open APIs (yfinance + FRED)
✓ Data reproducible (all code in src/fetch_options_market.py)

================================================================================
                    TASK FOR BUILDER_MODEL
================================================================================

Generate self-contained Kaggle notebook for options_market attempt 1:

1. NOTEBOOK STRUCTURE
   - Location: notebooks/options_market_1/train.ipynb
   - Kernel: bigbigzabuton/gold-model-training (unified for all submodels)
   - GPU: false (CPU-only, no neural network)
   - Runtime: ~3-5 minutes expected

2. DATA LOADING
   - Fetch from input CSV: data/processed/options_market_features.csv
   - Alignment with target: data/processed/target.csv
   - Split: train/val/test = 70/15/15 (time-series order)
   - Input columns: skew_close, gvz_close, skew_change, gvz_change

3. FEATURE ENGINEERING (via Optuna)

   Component 1: 2D HMM Regime Detection
   - Input: [SKEW daily changes, GVZ daily changes]
   - Model: hmmlearn.hmm.GaussianHMM
   - States: {2, 3}
   - Covariance: "full"
   - Output: options_risk_regime_prob [0, 1]

   Component 2: SKEW Tail Risk Z-Score
   - Input: SKEW closing levels
   - Window: {40, 60, 90} days (rolling)
   - Output: options_tail_risk_z [-4, +4] (clipped)

   Component 3: SKEW Momentum
   - Input: SKEW closing levels
   - Momentum window: {5, 10, 15} days
   - Z-score window: 60 days
   - Output: options_skew_momentum_z [-4, +4] (clipped)

4. HYPERPARAMETER OPTIMIZATION
   - Algorithm: Optuna with TPESampler
   - Objective: Maximize MI sum of 3 outputs vs gold_return_next on val set
   - Trials: 30
   - Timeout: 300 seconds (5 minutes)
   - Parameters:
     * hmm_n_components: {2, 3}
     * hmm_n_init: {3, 5, 10}
     * skew_zscore_window: {40, 60, 90}
     * skew_momentum_window: {5, 10, 15}

5. OUTPUT REQUIREMENTS
   - CSV: submodel_output.csv (columns: date, options_risk_regime_prob,
           options_tail_risk_z, options_skew_momentum_z)
   - JSON: training_result.json (best_params, metrics, MI scores)
   - Model: model.pt (HMM state for reproducibility)

================================================================================
                    IMPORTANT NOTES
================================================================================

1. HMMLEARN INSTALLATION
   - Must include: subprocess.check_call(['pip', 'install', 'hmmlearn'])
   - Not pre-installed on Kaggle

2. API KEYS
   - FRED_API_KEY from Kaggle Secrets (must be set in browser first)
   - os.environ['FRED_API_KEY'] will be used in notebook
   - No hardcoded values or fallbacks

3. NO LOOKAHEAD BIAS
   - HMM: fit on training data only, predict_proba on full dataset
   - Z-score: rolling window (inherently backward-looking)
   - Momentum: rolling window change (inherently backward-looking)

4. MUTUAL INFORMATION CALCULATION
   - Discretize features into 20 quantile bins
   - Use sklearn.metrics.mutual_info_score
   - Matches all previous 8 submodels

5. REPRODUCIBILITY
   - HMM random_state=42
   - Optuna seed=42
   - Z-score and momentum deterministic (no randomness)

================================================================================
                    RISKS & MITIGATIONS
================================================================================

Risk 1: No Predictive Signal (40% probability)
→ Design anticipates this. HMM regime detection may capture nonlinear patterns
  even if raw correlations are weak (<0.03). Will be tested by Gate 2/3.

Risk 2: HMM State Collapse (20% probability)
→ Sufficient data (1,961 training rows for 2D input). Multiple EM restarts
  (n_init={3,5,10}) reduce local optima risk.

Risk 3: SKEW Z-Score Autocorrelation >0.99 (15% probability)
→ SKEW changes have low autocorr (-0.20), 60-day rolling window adds smoothing.
  Expected AC: 0.85-0.95, well below 0.99 threshold.

Risk 4: VIF with VIX Submodel (15% probability)
→ GVZ used only in 2D HMM changes (not levels or ratios). Measured correlations
  with VIX outputs: all <0.27 (acceptable). HMM regime on different dimensions.

Risk 5: SKEW Noisiness (25% probability)
→ Design applies smoothing (60-day window) and momentum filtering (5-10 day).
  HMM extracts systematic regime patterns above noise.

Gate 2 is highest-risk gate (architect: 5/10 confidence for Gate 3 pass).
If Gate 2 fails on MI test, fallback strategy: focus on GVZ-only features.

================================================================================
                    VALIDATION ARTIFACTS
================================================================================

Report Files:
  - logs/datacheck/options_market_1_validation.json (JSON structured report)
  - logs/datacheck/options_market_1_report.md (detailed markdown report)
  - DATACHECKER_SUMMARY.md (executive summary)

Git Commits:
  - 18535ad: datacheck: options_market attempt 1 - PASS (all 7 steps)
  - d1643d7: datacheck: options_market attempt 1 - detailed validation report
  - 15c0ae2: state: datachecker complete - ready for builder_model

State:
  - status: in_progress
  - current_feature: options_market
  - current_attempt: 1
  - resume_from: builder_model
  - datachecker_status: PASS

================================================================================
                    WHAT'S NEXT
================================================================================

Builder Model Agent (Sonnet) will:

1. Read this handoff document and design spec (docs/design/options_market_1.md)
2. Generate self-contained train.ipynb notebook per specifications
3. Create kernel-metadata.json with unified notebook configuration
4. Commit notebook to git
5. Submit via Kaggle API: kaggle kernels push -p notebooks/options_market_1/
6. Update state.json with Kaggle kernel ID
7. Exit for manual evaluation OR trigger auto-monitoring (per config)

After Kaggle training completes:
- Evaluator will fetch results and run Gates 1, 2, 3
- If PASS: Move to next feature (real_rate next in queue)
- If FAIL: Return to architect for design iteration

================================================================================
                        STATUS: READY ✓
================================================================================

All validation complete. Data is clean, well-formed, and ready for Kaggle
notebook generation by builder_model agent.

Proceed immediately. No blocking issues.

================================================================================
